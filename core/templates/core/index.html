{% extends 'core/base.html' %}
{% load thumbnail %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="rounded mt-4 m-6 border border-2 border-primary">  
    <h2 class="p-3 fw-bold fs-4 text-center">Newest Designs</h2>
    <div id="newestDesignsCarousel" class="carousel slide" data-bs-ride="carousel">  
        {% if designs %}  
            <!-- Carousel indicators -->  
            <div class="carousel-indicators">  
                {% for design in designs %}  
                    <button type="button" data-bs-target="#newestDesignsCarousel"   
                            data-bs-slide-to="{{ forloop.counter0 }}"   
                            {% if forloop.first %}class="active" aria-current="true"{% endif %}   
                            aria-label="Design {{ forloop.counter }}"></button>  
                {% endfor %}  
            </div>  
              
            <!-- Carousel inner -->  
            <div class="carousel-inner">  
                {% for chunk in designs_chunks %}  
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">  
                        <div class="row px-4">  
                            {% for design in chunk %}  
                                <div class="col-lg-3 col-md-4 col-sm-6 col-6 mb-3">  <!-- Changed col-lg-2 to col-lg-3 -->  
                                    <a href="{% url 'design:detail' design.id %}" class="text-decoration-none">
                                        <div class="border rounded p-2 bg-white h-100">
                                            {% if design.first_image.url %}
                                                <img src="{{ design.first_image.url }}"
                                                     class="img-fluid rounded"
                                                     style="height: 220px; width: 100%; object-fit: cover;"
                                                     alt="{{ design.name }}">
                                            {% else %}
                                                <div class="bg-secondary d-flex align-items-center justify-content-center rounded"
                                                     style="height: 120px;">
                                                    <i class="bi bi-image text-white" style="font-size: 1.5rem;"></i>
                                                </div>
                                            {% endif %}
                                            <div class="mt-2">
                                                <h6 class="text-dark fw-bold text-truncate">{{ design.name }}</h6>
                                                <small class="text-secondary">{{ design.added_by }}</small>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <!-- Carousel controls -->  
            <button class="carousel-control-prev" type="button" data-bs-target="#newestDesignsCarousel" data-bs-slide="prev"  
                    style="background-color: rgba(162,228,54,1.0); border-radius: 50%; width: 50px; height: 50px;
                           top: 50%; transform: translateY(-50%); left: 15px; border: 2px solid rgba(20,20,20,1.0);">
                <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: brightness(0);"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#newestDesignsCarousel" data-bs-slide="next"
                    style="background-color: rgba(162,228,54,1.0); border-radius: 50%; width: 50px; height: 50px;
                            top: 50%; transform: translateY(-50%); right: 15px; border: 2px solid rgba(20,20,20,1.0);">
                <span class="carousel-control-next-icon" aria-hidden="true" style="filter: brightness(0);"></span> 
                <span class="visually-hidden">Next</span>  
            </button>
        {% endif %}  
    </div>  
</div>
<div class="rounded mt-4 m-6 border border-2 border-primary">  
    <h2 class="p-3 fw-bold fs-4 text-center">Categories</h2>
    <div class="row justify-content-center">
        {% for category in categories %}  
            <div class="col-md-5 mb-3">
                <a href="{% url 'core:browse_category' category.id %}" class="btn btn-primary btn-lg w-100 p-4">
                    <div class="text-center">
                        <h3 class="mb-2">{{ category.name }}</h3>
                        <p class="mb-1">{{ category.get_descendant_count }} subcategories</p>
                        <p class="mb-0">{{ category.get_total_design_count }} designs</p>
                    </div>
                </a>  
            </div>  
        {% endfor %}  
    </div>  
</div>
{% endblock%}
