{% extends 'core/base.html' %}  
  
{% block title %}  
    {% if query %}Search Results for "{{ query }}"{% else %}All Designs{% endif %}  
{% endblock %}  
  
{% block content %}  
<div class="container-fluid">  
    <div class="row">  
        <!-- Left Sidebar: Categories -->  
        <div class="col-md-3">  
            <div class="card">  
                <div class="card-header">  
                    <h5>Categories {% if has_search_results %}(with "{{ query }}"){% endif %}</h5>  
                </div>  
                <div class="card-body">  
                    {% if categories %}  
                        {% for category in categories %}  
                            <div class="d-flex justify-content-between align-items-center mb-2">  
                                <a href="{% url 'design:designs' %}?category={{ category.id }}{% if query %}&query={{ query }}{% endif %}{% if per_page %}&per_page={{ per_page }}{% endif %}"   
                                   class="text-decoration-none">  
                                    {{ category.name }}  
                                </a>  
                                <span class="badge bg-primary">{{ category.search_result_count }}</span>  
                            </div>  
                        {% endfor %}  
                    {% else %}  
                        <p class="text-muted">No categories found</p>  
                    {% endif %}  
                </div>  
            </div>  
        </div>  
          
        <!-- Right Content: Design Results -->  
        <div class="col-md-9">  
            <!-- Per-page selection and results count -->  
            <div class="d-flex justify-content-between align-items-center mb-3">  
                <div>  
                    {% if query %}  
                        <h4>Search Results for "{{ query }}"</h4>  
                        <small class="text-muted">{{ total_results }} designs found</small>  
                    {% else %}  
                        <h4>All Designs</h4>  
                        <small class="text-muted">{{ total_results }} total designs</small>  
                    {% endif %}  
                </div>  
                <div class="d-flex align-items-center">  
                    <label for="per-page-select" class="form-label me-2 mb-0">Show:</label>  
                    <select id="per-page-select" class="form-select form-select-sm" style="width: auto;" onchange="changePerPage(this.value)">  
                        <option value="25" {% if per_page == '25' %}selected{% endif %}>25</option>  
                        <option value="50" {% if per_page == '50' %}selected{% endif %}>50</option>  
                        <option value="all" {% if per_page == 'all' %}selected{% endif %}>All</option>  
                    </select>  
                </div>  
            </div>  
  
            {% if designs %}  
                <!-- Scrollable container for "All" option -->  
                <div class="{% if per_page == 'all' %}overflow-auto{% endif %}" {% if per_page == 'all' %}style="max-height: 70vh;"{% endif %}>  
                    <!-- Grid layout similar to Newest Designs -->  
                    <div class="row">  
                        {% for design in designs %}  
                            <div class="col-lg-3 col-md-4 col-sm-6 mb-4">  
                                <a href="{% url 'design:detail' design.id %}" class="text-decoration-none">  
                                    <div class="card h-100 shadow-sm">  
                                        <div class="position-relative">  
                                            {% if design.first_image.url %}  
                                                <img src="{{ design.first_image.url }}"   
                                                     class="card-img-top"   
                                                     style="height: 220px; width: 100%; object-fit: cover;"  
                                                     alt="{{ design.name }}">  
                                            {% else %}  
                                                <div class="bg-secondary d-flex align-items-center justify-content-center"  
                                                     style="height: 220px;">  
                                                    <i class="bi bi-image text-white" style="font-size: 2rem;"></i>  
                                                </div>  
                                            {% endif %}  
                                        </div>  
                                        <div class="card-body p-3">  
                                            <h6 class="card-title text-dark fw-bold mb-2 text-truncate">{{ design.name }}</h6>  
                                            <p class="card-text text-muted small mb-2">{{ design.description|truncatewords:10 }}</p>  
                                            <div class="d-flex justify-content-between align-items-center">  
                                                <small class="text-muted">{{ design.added_by.username }}</small>  
                                                <small class="text-muted">{{ design.created_at|date:"M d, Y" }}</small>  
                                            </div>  
                                            {% if design.tags.all %}  
                                                <div class="mt-2">  
                                                    {% for tag in design.tags.all|slice:":3" %}  
                                                        <span class="badge bg-light text-dark me-1" style="font-size: 0.7em;">{{ tag.name }}</span>  
                                                    {% endfor %}  
                                                </div>  
                                            {% endif %}  
                                        </div>  
                                    </div>  
                                </a>  
                            </div>  
                        {% endfor %}  
                    </div>  
                </div>  
  
                <!-- Pagination (only show if not "All") -->  
                {% if per_page != 'all' and is_paginated %}  
                    <nav aria-label="Design pagination" class="mt-4">  
                        <ul class="pagination justify-content-center">  
                            {% if page_obj.has_previous %}  
                            <li class="page-item">  
                                <a class="page-link" href="?page=1{% if query %}&query={{ query }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}&per_page={{ per_page }}">&laquo; First</a>  
                            </li>  
                            <li class="page-item">  
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if query %}&query={{ query }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}&per_page={{ per_page }}">Previous</a>  
                            </li>  
                            {% endif %}  
                              
                            <li class="page-item active">  
                                <span class="page-link">  
                                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}  
                                </span>  
                            </li>  
                              
                            {% if page_obj.has_next %}  
                            <li class="page-item">  
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if query %}&query={{ query }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}&per_page={{ per_page }}">Next</a>  
                            </li>  
                            <li class="page-item">  
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if query %}&query={{ query }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}&per_page={{ per_page }}">Last &raquo;</a>  
                            </li>  
                            {% endif %}  
                        </ul>  
                    </nav>  
                {% endif %}  
            {% else %}  
                <div class="alert alert-info mt-4">  
                    <i class="bi bi-info-circle me-2"></i>  
                    {% if query %}  
                        No designs found for "{{ query }}". Try searching with different keywords or browse categories on the left.  
                    {% else %}  
                        No designs available yet. <a href="{% url 'design:new' %}" class="alert-link">Upload the first design!</a>  
                    {% endif %}  
                </div>  
            {% endif %}  
        </div>  
    </div>  
</div>  
  
<!-- JavaScript for per-page selection -->  
<script>  
function changePerPage(value) {  
    const url = new URL(window.location);  
    url.searchParams.set('per_page', value);  
    url.searchParams.delete('page'); // Reset to first page when changing per_page  
    window.location.href = url.toString();  
}  
</script>  
{% endblock %}
