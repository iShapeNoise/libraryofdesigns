{% extends 'core/base.html' %}  
  
{% block title %}{{ course_name|upper }} Course{% endblock %}  
  
{% block content %}  
<div class="container-fluid p-0">  
    <!-- Chapters Accordion - Full Width -->  
    {% if chapters %}  
    <div class="accordion" id="courseAccordion">  
        {% for chapter in chapters %}  
        <div class="accordion-item">  
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">  
                <button class="accordion-button collapsed"   
                        type="button"   
                        data-bs-toggle="collapse"   
                        data-bs-target="#collapse{{ forloop.counter }}"   
                        aria-expanded="false"   
                        aria-controls="collapse{{ forloop.counter }}">  
                    {{ chapter.title }}  
                </button>  
            </h2>  
            <div id="collapse{{ forloop.counter }}"   
                 class="accordion-collapse collapse"   
                 aria-labelledby="heading{{ forloop.counter }}"   
                 data-bs-parent="#courseAccordion">  
                <div class="accordion-body">  
                    {{ chapter.content|safe }}  
                </div>  
            </div>  
        </div>
        {% endfor %}  
    </div>  
    {% else %}  
    <div class="alert alert-info m-3">  
        <i class="fas fa-info-circle"></i> No chapters found for this course.  
    </div>  
    {% endif %}  
</div>  

<script>  
document.addEventListener('DOMContentLoaded', function() {  
    const accordionElement = document.getElementById('courseAccordion');  
      
    if (accordionElement) {  
        // Store button positions before any changes  
        let targetButton = null;  
          
        // Listen for when accordion is about to show  
        accordionElement.addEventListener('show.bs.collapse', function (event) {  
            const targetId = event.target.id;  
            targetButton = document.querySelector(`[data-bs-target="#${targetId}"]`);  
        });  
          
        // Listen for when accordion has finished showing  
        accordionElement.addEventListener('shown.bs.collapse', function (event) {  
            if (targetButton) {  
                // Use requestAnimationFrame to ensure DOM is fully updated  
                requestAnimationFrame(() => {  
                    const rect = targetButton.getBoundingClientRect();  
                    const scrollTop = window.pageYOffset;  
                    const targetPosition = scrollTop + rect.top - 80; // 80px offset from top  
                      
                    window.scrollTo({  
                        top: Math.max(0, targetPosition),  
                        behavior: 'smooth'  
                    });  
                });  
            }  
        });  
    }  
});  
</script>
{% endblock %}
