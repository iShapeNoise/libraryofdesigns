// Do not edit this file; automatically generated by openscad_build.py.
"use strict";
var openscadpage={start:function(){var e="";return e+='  <div id="main">\n',e+='    <nav class="navbar navbar-default" id="top-navigation-bar">\n',e+='      <div class="container-fluid">\n',e+='        <a href="#" class="pull-left"><img src="imgs/bslogo.png" style="max-height:50px"></a>\n',e+='        <ul class="nav navbar-nav">\n',e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><img src="imgs/globe.png" style="width:20px"><span class="caret"></span></a>\n',e+='            <ul id="languageMenu" class="dropdown-menu" role="menu">\n',e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown"> \n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+OpenSCAD.Msg.PROJECT_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="file-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="#" class="new-project">'+OpenSCAD.Msg.NEW+"</a></li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="saveLocal">'+OpenSCAD.Msg.SAVE_BLOCKS_LOCAL+"</a></li>\n",e+="              <li>\n",e+='                <input type="file" accept=".xml" id="loadLocal" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='                <a href="#" onclick="document.getElementById(\'loadLocal\').click(); return false">'+OpenSCAD.Msg.LOAD_BLOCKS_LOCAL+"</a>\n",e+="              </li>\n",e+='              <li class="divider"></li>\n',e+="              <li>\n",e+='                <input type="file" accept=".xml" id="importLocal" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='                <a href="#" onclick="document.getElementById(\'importLocal\').click(); return false">'+OpenSCAD.Msg.IMPORT_BLOCKS_LOCAL+"</a>\n",e+="              </li>\n",e+="              <li>\n",e+='                <input type="file" accept=".stl" id="importStl" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='                <a href="#" onclick="document.getElementById(\'importStl\').click(); return false">'+OpenSCAD.Msg.IMPORT_STL_MENU+"</a>\n",e+="              </li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="saveOpenscad">'+OpenSCAD.Msg.SAVE_SCAD_LOCAL+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+OpenSCAD.Msg.OPTIONS_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="options-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="#" id="simpleToolbox">'+OpenSCAD.Msg.SIMPLE_TOOLBOX+"</a></li>\n",e+='              <li><a href="#" id="advancedToolbox">'+OpenSCAD.Msg.ADVANCED_TOOLBOX+"</a></li>\n",e+="              <li>\n",e+='                <a class="trigger right-caret">'+OpenSCAD.Msg.BLOCK_COLORS+"</a>\n",e+='                <ul class="dropdown-menu sub-menu">\n',e+='                  <li><a href="#" id="colors_one">'+OpenSCAD.Msg.CLASSIC_COLORS+"</a></li>\n",e+='                  <li><a href="#" id="colors_two">'+OpenSCAD.Msg.PALE_COLORS+"</a></li>\n",e+="                </ul>\n",e+="              </li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+OpenSCAD.Msg.HELP_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="help-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="docs/" target="_blank">'+OpenSCAD.Msg.DOCUMENTATION_LINK+"</a></li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" data-toggle="modal" data-target="#about-modal">'+OpenSCAD.Msg.ABOUT_LINK+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+OpenSCAD.Msg.EXAMPLES_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="examples-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="#" id="examples_cube_with_cutouts">'+OpenSCAD.Msg.EXAMPLE_CUBE_WITH_CUTOUTS+"</a></li>\n",e+='              <li><a href="#" id="examples_anthias_fish">'+OpenSCAD.Msg.EXAMPLE_ANTHIAS_FISH+"</a></li>\n",e+='              <li><a href="#" id="examples_torus">'+OpenSCAD.Msg.TORUS+"</a></li>\n",e+='              <li><a href="#" id="examples_box">'+OpenSCAD.Msg.EXAMPLE_PARAMETRIC_BOX+"</a></li>\n",e+='              <li><a href="#" id="examples_linear_extrude">'+OpenSCAD.Msg.LINEAR_EXTRUDE+"</a></li>\n",e+='              <li><a href="#" id="examples_rotate_extrude">'+OpenSCAD.Msg.ROTATE_EXTRUDE+"</a></li>\n",e+='              <li><a href="#" id="examples_hulled_loop_sun">'+OpenSCAD.Msg.EXAMPLE_LOOP_SUN+"</a></li>\n",e+='              <li><a href="#" id="examples_sine_function_with_loop">'+OpenSCAD.Msg.EXAMPLE_LOOP_SINE+"</a></li>\n",e+='              <li><a href="#" id="examples_trefoil_knot_param_eq">'+OpenSCAD.Msg.EXAMPLE_PARAMETRIC_EQ_KNOT+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='             <a type="button" class="btn btn-default btn-lg" style="margin-top:2px" href="https://youtu.be/5RNKVn7lijM" target="_blank">'+OpenSCAD.Msg.GET_STARTED_VIDEO+"</a>",e+="        </ul>\n",e+='        <div id="login-area" class="navbar-right">\n',e+="        </div>\n",e+="      </div>  \x3c!-- /.container-fluid --\x3e\n",e+="    </nav>\n",e+="            </div>\n",e+="          </div>\n",e+='          <button id="trashButton" class="btn btn-default notext" title="'+OpenSCAD.Msg.MOUSEOVER_TRASHCAN+'">\n',e+='            <img src="blockly/media/1x1.gif" class="trash icon21">\n',e+="          </button>\n",e+="        </div> \x3c!-- undo/redo/trash div --\x3e \n",e+="      </nav> \x3c!-- end second nav row --\x3e\n",e+="      \x3c!-- End of the header content --\x3e\n",e+="\n",e+="      \x3c!-- beginning of page content (blockly + viewer) --\x3e\n",e+='      <div class="tab-content">\n',e+='        <div class="tab-pane active" id="blocklyContainer">\n',e+='          <div id="blocklyDiv">\n',e+="\n",e+='            <div class="resizableDiv">\n',e+='              <div id="renderDiv">\n',e+='                \x3c!-- <input type="text" id="colorButton"/> --\x3e\n',e+="              </div> \x3c!--renderDiv --\x3e\n",e+='              <div id="paneContainer">\n',e+='                <div id="viewerButtons">\n',e+='                  <div class="btn-group">\n',e+='                    <input type="text" id="defColor"/>\n',e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="axesButton" type="button" title="'+OpenSCAD.Msg.AXES_BUTTON+'" class="btn vbut btn-default">\n',e+='                      <svg viewbox="0 0 26 26">\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m9 0.5v15h15"/>\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m9 15-9 9"/>\n',e+="                      </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="zInButton" type="button" title="'+OpenSCAD.Msg.ZOOM_IN_BUTTON+'" class="btn vbut btn-default">\n',e+='                      <svg viewbox="0 0 26 26">\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m13 6v14m-7-7h14"/>\n',e+="                      </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="zOutButton" type="button" title="'+OpenSCAD.Msg.ZOOM_OUT_BUTTON+'" class="btn vbut btn-default">\n',e+='                      <svg viewbox="0 0 26 26">\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m6 13h14"/>\n',e+="                      </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="viewReset" type="button" title="'+OpenSCAD.Msg.RESET_VIEW_BUTTON+'" class="btn vbut btn-default">\n',e+='                      <svg viewbox="0 0 26 26">\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m13 6v14m-7-7h14"/>\n',e+="                      </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+="                </div>\n",e+='                <div id="renderPane">\n',e+='                  <button type="button" class="btn btn-default btn-lg changeable" id="renderButton">'+OpenSCAD.Msg.RENDER_BUTTON+"</button>\n",e+='                  <button type="button" class="btn btn-default btn-lg btn-danger " id="abortButton">'+OpenSCAD.Msg.ABORT_BUTTON+"</button>\n",e+='                  <div id="stl_buttons" class="pull-right" style="padding:5px 5px;">\n',e+='                    <select id="render-type" style="padding:2px 4px;"></select>\n',e+='                    <button type="button" class="btn btn-default btn-lg changeable" id="stlButton">'+OpenSCAD.Msg.GENERATE_STL+"</button>\n",e+="                  </div>\n",e+='                  <div id="render-ongoing">'+OpenSCAD.Msg.PARSE_IN_PROGRESS+'  <img id=busy src="imgs/busy2.gif"></div>\n',e+='                  <div id="error-message"></div>\n',e+="                </div>\n",e+='                <div id="renderPane">\n',e+='                  <button type="button" class="btn btn-default btn-lg changeable" id="renderButton">'+OpenSCAD.Msg.RENDER_BUTTON+"</button>\n",e+='                  <button type="button" class="btn btn-default btn-lg btn-danger " id="abortButton">'+OpenSCAD.Msg.ABORT_BUTTON+"</button>\n",e+='                  <div id="stl_buttons" class="pull-right" style="padding:5px 5px;">\n',e+='                    <select id="render-type" style="padding:2px 4px;"></select>\n',e+='                    <button type="button" class="btn btn-default btn-lg changeable" id="stlButton">'+OpenSCAD.Msg.GENERATE_STL+"</button>\n",e+="                  </div>\n",e+='                  <div id="render-ongoing">'+OpenSCAD.Msg.PARSE_IN_PROGRESS+'  <img id=busy src="imgs/busy2.gif"></div>\n',e+='                  <div id="error-message"></div>\n',e+="                </div>\n",e+="              </div> \x3c!-- paneContainer --\x3e\n",e+="            </div> \x3c!-- resizable div --\x3e\n",e+="          </div> \x3c!-- blocklyDiv --\x3e\n",e+="        </div>\n",e+="        \x3c!-- Blockly Container (tab pane)--\x3e\n",e+='        <pre class="tab-pane content" id="openScadPre"></pre>',e+="      </div> \x3c!-- tab-content --\x3e\n",e+="    </div> \x3c!-- editView --\x3e\n",e+="  </div> \x3c!-- main --\x3e\n",e+="  \x3c!-- About Modal --\x3e\n",e+='  <div class="modal fade" id="about-modal" tabindex="-1" role="dialog">\n',e+='    <div class="modal-dialog" role="document">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <button type="button" class="close" data-dismiss="modal">&times;</button>\n',e+='          <h4 class="modal-title">'+OpenSCAD.Msg.ABOUT_TITLE+"</h4>\n",e+="        </div>\n",e+='        <div class="modal-body">\n',e+="          <p>"+OpenSCAD.Msg.ABOUT_TEXT+"</p>\n",e+="          <p>Version "+OpenSCAD.version+"</p>\n",e+="        </div>\n",e+='        <div class="modal-footer">\n',e+='          <button type="button" class="btn btn-default" data-dismiss="modal">'+OpenSCAD.Msg.CLOSE+"</button>\n",e+="        </div>\n",e+="      </div>\n",e+="    </div>\n",e+="  </div>\n",e+="  \x3c!-- Additional modals and project tables --\x3e\n"}},openscadpage=openscadpage||{};"use strict";var BlocklyStorage=BlocklyStorage||{},Openscad=Openscad||{};Openscad.Auth=Openscad.Auth||{};var Blockly=Blockly||{};Blockly.Xml=Blockly.Xml||{},BlocklyStorage.autosaveBlocks=function(e){"localStorage"in window&&(localStorage.xml=e,localStorage.proj_name=$("#project-name").val())},BlocklyStorage.standaloneRestoreBlocks=function(){if(localStorage.xml){var e=Blockly.Xml.textToDom(localStorage.xml);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e);var t=localStorage.proj_name;"undefined"!=t?$("#project-name").val(t):$("#project-name").val("Untitled")}},BlocklyStorage.backupBlocks_=function(){if("localStorage"in window){localStorage.clear();for(var e=Blockly.Xml.workspaceToDom(Openscad.workspace),t=window.location.href.split("#")[0],n=(t=t.split("?lang")[0])+"proj_name",r=t+"current_project",o=t+"current_project_key",i=t+"needToSave",a=t+"pLang",s=Openscad.workspace.getAllBlocks(),l=0;l<s.length;l++)if("stl_import"==s[l].type){var c=s[l].getField("STL_CONTENTS").getText();if(c.length>0){var d=t+c,u=t+c+"center";if(Openscad.csg_commands[c].length<3e6){var f=Base64.toBase64(RawDeflate.deflate(Base64.utob(Blockscad.csg_commands[c])));window.localStorage.setItem(d,f),window.localStorage.setItem(u,Blockscad.csg_center[c])}}}window.localStorage.setItem(t,Blockly.Xml.domToText(e)),window.localStorage.setItem(n,$("#project-name").val()),window.localStorage.setItem(r,Openscad.Auth.currentProject),window.localStorage.setItem(o,Openscad.Auth.currentProjectKey),window.localStorage.setItem(i,Openscad.needToSave),Openscad.pLang?window.localStorage.setItem(a,Openscad.pLang):localStorage.removeItem(a)}},BlocklyStorage.backupOnUnload=function(){window.addEventListener("unload",BlocklyStorage.backupBlocks_,!1)},BlocklyStorage.restoreBlocks=function(){var e=window.location.href.split("#")[0],t=(e=e.split("?lang")[0])+"proj_name",n=e+"current_project",r=e+"current_project_key",o=e+"needToSave";if("localStorage"in window&&window.localStorage[e]){var i=Blockly.Xml.textToDom(window.localStorage[e]);Blockly.Xml.domToWorkspace(i,Openscad.workspace);for(var a=Openscad.workspace.getAllBlocks(),s=0;s<a.length;s++)if("stl_import"==a[s].type){var l=a[s].getField("STL_CONTENTS").getText(),c=a[s].getField("STL_FILENAME").getText(),d=a[s].getField("STL_BUTTON");if(l.length>0){var u=e+l,f=e+l+"center",h=window.localStorage[u],p=window.localStorage[f];if(h&&h.length>0){d.setVisible(!1),console.log("csg contents compressed length is:",h.length);var g=Base64.btou(RawDeflate.inflate(Base64.fromBase64(h)));console.log("decompressed lengeth is:",g.length),Openscad.csg_commands[l]=g,Openscad.csg_filename[l]=c+":::",Openscad.csg_center[l]=p,a[s].render()}else{console.log("couldn't find the stl in localStorage"),$("#error-message").html("Warning: Re-load your .STL files"),a[s].getField("STL_CONTENTS").setText(""),a[s].getField("STL_FILENAME").setText("");var m=a[s].getCommentText();m.match(/^RELOAD/)||(m="RELOAD: "+m),a[s].setCommentText(m),d.setText("Reload"),a[s].backlight();var v=a[s].collapsedParents();if(v)for(var w=0;w<v.length;w++)v[w].backlight();a[s].isCollapsed()||d.setVisible(!0);for(var y=a[s],S=null;y;)y.isCollapsed()&&(S=y),y=y.getSurroundParent();S&&S.setCollapsed(!0,!0),a[s].render()}}}var x=window.localStorage[t];"undefined"!=x?$("#project-name").val(x):$("#project-name").val("Untitled");var A=window.localStorage[n];Openscad.Auth.currentProject="undefined"!=A?A:"";var b=window.localStorage[r];"undefined"!=b&&(Openscad.Auth.currentProjectKey=b);var _=Number(window.localStorage[o]);"undefined"==_||1!=_&&0!=_||setTimeout(function(){Openscad.needToSave=_},300)}},Openscad.getLangFromLS=function(){var e=window.location.href.split("#")[0],t=(e=e.split("?lang")[0])+"pLang";return window.localStorage[t]};var BSUtils=BSUtils||{};BSUtils.LANGUAGE_NAME={en:"English",de:"Deutsch",fr:"Français","zh-hans":"簡體中文",sl:"Slovenščina"},BSUtils.LANGUAGE_RTL=["ar","fa","he"],BSUtils.LANGUAGES=void 0,BSUtils.getStringParamFromUrl=function(e,t){var n=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)"));return n?decodeURIComponent(n[1].replace(/\+/g,"%20")):t},BSUtils.getLang=function(){var e=BSUtils.getStringParamFromUrl("lang","");if(void 0===BSUtils.LANGUAGE_NAME[e]){var t=Blockscad.getLangFromLS();e=t&&"null"!=t?t:"en"}return Blockscad.pLang=e,e},BSUtils.LANG=BSUtils.getLang(),BSUtils.isRtl=function(){return-1!=BSUtils.LANGUAGE_RTL.indexOf(BSUtils.LANG)},BSUtils.initReadonly=function(){Blockly.inject(document.getElementById("blockly"),{path:"./",readOnly:!0,rtl:BSUtils.isRtl(),scrollbars:!1});var e=BSUtils.getStringParamFromUrl("xml","");e=Blockly.Xml.textToDom("<xml>"+e+"</xml>"),Blockly.Xml.domToWorkspace(e,Blockly.mainWorkspace)},BSUtils.loadBlocks=function(e){if(e){var t=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(t,Blockly.mainWorkspace)}else"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)},BSUtils.changeLanguage=function(){console.log("in changeLanguage"),BlocklyStorage.backupBlocks_();var e=encodeURIComponent($(this).data("lang"));console.log("newLang is:",e);var t=window.location.search;t=t.length<=1?"?lang="+e:t.match(/[?&]lang=[^&]*/)?t.replace(/([?&]lang=)[^&]*/,"$1"+e):t.replace(/\?/,"?lang="+e+"&"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+t},BSUtils.isDialogVisible_=!1,BSUtils.dialogOrigin_=null,BSUtils.dialogDispose_=null,BSUtils.showDialog=function(e,t,n,r,o,i){BSUtils.isDialogVisible_&&BSUtils.hideDialog(!1),BSUtils.isDialogVisible_=!0,BSUtils.dialogOrigin_=t,BSUtils.dialogDispose_=i;var a=document.getElementById("dialog"),s=document.getElementById("dialogShadow"),l=document.getElementById("dialogBorder");for(var c in o)a.style[c]=o[c];if(r){s.style.visibility="visible",s.style.opacity=.3;var d=document.createElement("div");d.id="dialogHeader",a.appendChild(d),BSUtils.dialogMouseDownWrapper_=Blockly.bindEvent_(d,"mousedown",null,BSUtils.dialogMouseDown_)}function u(){BSUtils.isDialogVisible_&&(a.style.visibility="visible",a.style.zIndex=1,l.style.visibility="hidden")}a.appendChild(e),e.className=e.className.replace("dialogHiddenContent",""),n&&t?(BSUtils.matchBorder_(t,!1,.2),BSUtils.matchBorder_(a,!0,.8),window.setTimeout(u,175)):u()},BSUtils.dialogStartX_=0,BSUtils.dialogStartY_=0,BSUtils.dialogMouseDown_=function(e){if(BSUtils.dialogUnbindDragEvents_(),!Blockly.isRightButton(e)){var t=document.getElementById("dialog");BSUtils.dialogStartX_=t.offsetLeft-e.clientX,BSUtils.dialogStartY_=t.offsetTop-e.clientY,BSUtils.dialogMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",null,BSUtils.dialogUnbindDragEvents_),BSUtils.dialogMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",null,BSUtils.dialogMouseMove_),e.stopPropagation()}},BSUtils.dialogMouseMove_=function(e){var t=document.getElementById("dialog"),n=BSUtils.dialogStartX_+e.clientX,r=BSUtils.dialogStartY_+e.clientY;r=Math.max(r,0),r=Math.min(r,window.innerHeight-t.offsetHeight),n=Math.max(n,0),n=Math.min(n,window.innerWidth-t.offsetWidth),t.style.left=n+"px",t.style.top=r+"px"},BSUtils.dialogUnbindDragEvents_=function(){BSUtils.dialogMouseUpWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseUpWrapper_),BSUtils.dialogMouseUpWrapper_=null),BSUtils.dialogMouseMoveWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseMoveWrapper_),BSUtils.dialogMouseMoveWrapper_=null)},BSUtils.hideDialog=function(e){if(BSUtils.isDialogVisible_){BSUtils.dialogUnbindDragEvents_(),BSUtils.dialogMouseDownWrapper_&&(Blockly.unbindEvent_(BSUtils.dialogMouseDownWrapper_),BSUtils.dialogMouseDownWrapper_=null),BSUtils.isDialogVisible_=!1,BSUtils.dialogDispose_&&BSUtils.dialogDispose_(),BSUtils.dialogDispose_=null;var t=!1===e?null:BSUtils.dialogOrigin_,n=document.getElementById("dialog"),r=document.getElementById("dialogShadow"),o=document.getElementById("dialogBorder");r.style.opacity=0,t?(BSUtils.matchBorder_(n,!1,.8),BSUtils.matchBorder_(t,!0,.2),window.setTimeout(s,175)):s(),n.style.visibility="hidden",n.style.zIndex=-1;var i=document.getElementById("dialogHeader");for(i&&i.parentNode.removeChild(i);n.firstChild;){var a=n.firstChild;a.className+=" dialogHiddenContent",document.body.appendChild(a)}}function s(){r.style.visibility="hidden",o.style.visibility="hidden"}},BSUtils.matchBorder_=function(e,t,n){if(e){var r=document.getElementById("dialogBorder"),o=BSUtils.getBBox_(e);t?(r.className="dialogAnimate",window.setTimeout(i,1)):(r.className="",i()),r.style.visibility="visible"}function i(){r.style.width=o.width+"px",r.style.height=o.height+"px",r.style.left=o.x+"px",r.style.top=o.y+"px",r.style.opacity=n}},BSUtils.getBBox_=function(e){var t=e.offsetHeight,n=e.offsetWidth,r=0,o=0;do{r+=e.offsetLeft,o+=e.offsetTop,e=e.offsetParent}while(e);return{height:t,width:n,x:r,y:o}},BSUtils.storageAlert=function(e){var t=document.getElementById("containerStorage");t.textContent="";for(var n=e.split("\n"),r=0;r<n.length;r++){var o=document.createElement("p");o.appendChild(document.createTextNode(n[r])),t.appendChild(o)}var i=document.getElementById("dialogStorage"),a=document.getElementById("linkButton");BSUtils.showDialog(i,a,!0,!0,{width:"50%",left:"25%",top:"5em"},BSUtils.stopDialogKeyDown()),BSUtils.startDialogKeyDown()},BSUtils.dialogKeyDown_=function(e){BSUtils.isDialogVisible_&&(13!=e.keyCode&&27!=e.keyCode&&32!=e.keyCode||(BSUtils.hideDialog(!0),e.stopPropagation(),e.preventDefault()))},BSUtils.startDialogKeyDown=function(){document.body.addEventListener("keydown",BSUtils.dialogKeyDown_,!0)},BSUtils.stopDialogKeyDown=function(){document.body.removeEventListener("keydown",BSUtils.dialogKeyDown_,!0)},BSUtils.getMsg=function(e){var t=BSUtils.getMsgOrNull(e);return null===t?"[Unknown message: "+e+"]":t},BSUtils.getMsgOrNull=function(e){var t=document.getElementById(e);if(t){var n=t.textContent;return n=n.replace(/\\n/g,"\n")}return null},BSUtils.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var e,t=document.getElementsByTagName("button"),n=0;e=t[n];n++)e.ontouchend||(e.ontouchend=e.onclick)},window.addEventListener("load",BSUtils.addTouchEvents,!1),BSUtils.bindClick=function(e,t){"string"==typeof e&&(e=document.getElementById(e)),e.addEventListener("click",t,!0),e.addEventListener("touchend",t,!0)};var OpenSCAD=OpenSCAD||{};OpenSCAD.version="1.0.0",OpenSCAD.offline=!0,OpenSCAD.drawAxes=1,OpenSCAD.resolution=1,OpenSCAD.editor=null,OpenSCAD.viewer=null,OpenSCAD.picSize=[450,450],OpenSCAD.rpicSize=[250,250],OpenSCAD.picQuality=.85,OpenSCAD.numRotPics=13,OpenSCAD.init=function(){console.log("Initializing OpenSCAD text editor..."),OpenSCAD.initTextEditor(),OpenSCAD.initViewer(),OpenSCAD.setupEventHandlers(),console.log("OpenSCAD text editor initialized successfully")},OpenSCAD.initTextEditor=function(){const e=document.getElementById("codeEditor");e?(OpenSCAD.editor=CodeMirror.fromTextArea(e,{mode:"text/x-csrc",theme:"monokai",lineNumbers:!0,autoCloseBrackets:!0,matchBrackets:!0,lineWrapping:!0,indentUnit:2,tabSize:2}),OpenSCAD.editor.getValue().trim()||OpenSCAD.editor.setValue("// OpenSCAD Text Editor  \n// Create your 3D designs here  \n  \n// Example: Simple cube  \ncube([10, 10, 10]);  \n  \n// Example: Cylinder  \ntranslate([15, 0, 0])  \n    cylinder(h=10, r=5);  \n  \n// Example: Sphere  \ntranslate([0, 15, 0])  \n    sphere(r=5);"),console.log("CodeMirror editor initialized")):console.error("Error: codeEditor element not found")},OpenSCAD.initViewer=function(){const e=document.getElementById("renderDiv");if(e){0!==e.offsetWidth&&0!==e.offsetHeight||(e.style.width="100%",e.style.height="100%",e.style.minHeight="400px");try{OpenSCAD.viewer=new OpenSCAD.Viewer(e,e.offsetWidth,e.offsetHeight,100),OpenSCAD.viewer.plate=!0,OpenSCAD.viewer.onDraw(),console.log("3D viewer initialized successfully")}catch(t){console.error("3D viewer initialization error: "+t.message);try{void 0!==Openscad&&Openscad.Viewer&&(OpenSCAD.viewer=new Openscad.Viewer(e,e.offsetWidth,e.offsetHeight,100),OpenSCAD.viewer.plate=!0,OpenSCAD.viewer.onDraw(),console.log("3D viewer initialized with fallback"))}catch(e){console.error("Fallback viewer initialization failed: "+e.message)}}}else console.error("Error: renderDiv not found")},OpenSCAD.setupEventHandlers=function(){const e=document.getElementById("previewBtn");e&&e.addEventListener("click",OpenSCAD.previewCode);const t=document.getElementById("saveBtn");t&&t.addEventListener("click",OpenSCAD.saveDesign);const n=document.getElementById("newBtn");n&&n.addEventListener("click",OpenSCAD.newDesign);const r=document.getElementById("exportBtn");r&&r.addEventListener("click",OpenSCAD.exportSTL);const o=document.getElementById("renderBtn");o&&o.addEventListener("click",OpenSCAD.renderCode),console.log("Event handlers setup complete")},OpenSCAD.previewCode=function(){if(!OpenSCAD.editor||!OpenSCAD.viewer)return console.error("Editor or viewer not initialized"),void OpenSCAD.addConsoleMessage("Editor or viewer not ready","error");const code=OpenSCAD.editor.getValue();if(code.trim()){console.log("Previewing OpenSCAD code..."),OpenSCAD.addConsoleMessage("Previewing OpenSCAD code...","info");try{const parsedCode=openscadOpenJscadParser.parse(code),csgObject=eval("("+parsedCode+")")();csgObject&&(csgObject instanceof CSG||csgObject instanceof CAG)?(OpenSCAD.viewer.setCsg(csgObject),OpenSCAD.addConsoleMessage("Preview completed successfully","success"),console.log("Preview completed successfully")):(OpenSCAD.addConsoleMessage("No valid 3D object generated","error"),console.error("No valid 3D object generated"))}catch(e){OpenSCAD.addConsoleMessage("Preview error: "+e.message,"error"),console.error("Preview error: "+e.message)}}else OpenSCAD.addConsoleMessage("Please enter some OpenSCAD code first","warning")},OpenSCAD.renderCode=function(){if(!OpenSCAD.editor)return void console.error("Editor not initialized");if(OpenSCAD.editor.getValue().trim()){OpenSCAD.addConsoleMessage("Rendering OpenSCAD code...","info"),console.log("Rendering OpenSCAD code...");try{OpenSCAD.previewCode()}catch(e){OpenSCAD.addConsoleMessage("Render error: "+e.message,"error"),console.error("Render error: "+e.message)}}else OpenSCAD.addConsoleMessage("Please enter some OpenSCAD code first","warning")},OpenSCAD.saveDesign=function(){if(!OpenSCAD.editor)return void console.error("Editor not initialized");const e=OpenSCAD.editor.getValue(),t=prompt("Enter filename:","design.scad")||"design.scad";try{const n=new Blob([e],{type:"text/plain"});if("function"==typeof saveAs)saveAs(n,t),OpenSCAD.addConsoleMessage("Design saved as "+t,"success");else{const e=URL.createObjectURL(n),r=document.createElement("a");r.href=e,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(e),OpenSCAD.addConsoleMessage("Design downloaded as "+t,"success")}}catch(e){OpenSCAD.addConsoleMessage("Save error: "+e.message,"error"),console.error("Save error: "+e.message)}},OpenSCAD.newDesign=function(){OpenSCAD.editor?confirm("Create new design? Unsaved changes will be lost.")&&(OpenSCAD.editor.setValue("// New OpenSCAD design  \n// Start creating your 3D model here  \n  \ncube([10, 10, 10]);"),OpenSCAD.addConsoleMessage("New design created","info")):console.error("Editor not initialized")},OpenSCAD.exportSTL=function(){OpenSCAD.addConsoleMessage("Exporting STL...","info");try{if(OpenSCAD.viewer&&OpenSCAD.viewer.meshes&&OpenSCAD.viewer.meshes.length>0){const e=OpenSCAD.viewer.currentObject||OpenSCAD.viewer.meshes[0];if(e&&"function"==typeof e.toStlString){const t=e.toStlString(),n=new Blob([t],{type:"application/octet-stream"});if("function"==typeof saveAs)saveAs(n,"model.stl");else{const e=URL.createObjectURL(n),t=document.createElement("a");t.href=e,t.download="model.stl",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}OpenSCAD.addConsoleMessage("STL exported successfully","success")}else OpenSCAD.addConsoleMessage("No valid 3D model to export","error")}else OpenSCAD.addConsoleMessage("3D viewer not ready for export","error")}catch(e){OpenSCAD.addConsoleMessage("Export error: "+e.message,"error"),console.error("Export error: "+e.message)}},OpenSCAD.addConsoleMessage=function(e,t){t=t||"info";const n=document.getElementById("consoleOutput");if(n){const r=document.createElement("div");r.className="text-"+("error"===t?"danger":"success"===t?"success":"info"),r.textContent=(new Date).toLocaleTimeString()+": "+e,n.appendChild(r),n.scrollTop=n.scrollHeight}console.log(t.toUpperCase()+": "+e)},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){OpenSCAD.init()},1e3)}),document.addEventListener("keydown",function(e){"F5"===e.key?(e.preventDefault(),OpenSCAD.previewCode()):"F6"===e.key?(e.preventDefault(),OpenSCAD.renderCode()):e.ctrlKey&&"s"===e.key&&(e.preventDefault(),OpenSCAD.saveDesign())}),window.OpenSCAD=OpenSCAD;var Openscad=Openscad||{};Blockscad.fonts={},Openscad.fontList=["/fonts/Roboto/Roboto-Bold.ttf","/fonts/liberation/LiberationSerif-Bold.ttf","/fonts/nimbus/nimbus-sans-l_bold.ttf","/fonts/AverageMono/AverageMonoSimp.ttf","/fonts/Open_Sans/OpenSans-ExtraBold.ttf","/fonts/stardos-stencil/StardosStencil-Bold.ttf","/fonts/Chewy/Chewy.ttf","/fonts/bangers/Bangers.ttf"],Openscad.fontName=["Roboto","Liberation Serif","Nimbus Sans","Average Mono","Open Sans","Stardos Stencil","Chewy","Bangers"],Openscad.loadFonts=function(){for(var e=0;e<Openscad.fontList.length;e++)Openscad.loadFont(e)},Openscad.loadFont=function(e){opentype.load(Openscad.fontList[e],function(t,n){if(!t)return Openscad.fonts[Openscad.fontName[e]]=n,n;console.log("Could not load font: ",n+":"+t)})},Openscad.loadFontThenRender=function(e,t){try{Openscad.fontName[Openscad.loadTheseFonts[e]];var n=Openscad.fontList[Openscad.loadTheseFonts[e]],r=new XMLHttpRequest;r.open("get",n,!0),r.responseType="arraybuffer",r.onload=function(){if(200!==r.status)throw new Error("failed to load font in loadRawFont:"+n+r.statusText);Openscad.fonts[Openscad.fontName[Openscad.loadTheseFonts[e]]]=r.response,Openscad.numloaded++,Openscad.numloaded==Openscad.loadTheseFonts.length&&Openscad.renderCode(t)},r.send()}catch(e){console.log("network error loading font in loadFontThenRender with: ",e)}},Openscad.whichFonts=function(e){for(var t=[],n=0;n<Openscad.fontList.length;n++)e.indexOf(Openscad.fontName[n])>-1&&(Openscad.fonts[Openscad.fontName[n]]||t.push(n));return t};var GL=function(){function e(e,t,n){n=n||{},this.id=u.createTexture(),this.width=e,this.height=t,this.format=n.format||u.RGBA,this.type=n.type||u.UNSIGNED_BYTE,u.bindTexture(u.TEXTURE_2D,this.id),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n.filter||n.magFilter||u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,n.filter||n.minFilter||u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n.wrap||n.wrapS||u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n.wrap||n.wrapT||u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,null)}var t,n,r;function o(){this.unique=[],this.indices=[],this.map={}}function i(e,t){this.buffer=null,this.target=e,this.type=t,this.data=[]}function a(e){e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),"triangles"in e&&!e.triangles||this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")}e.prototype={bind:function(e){u.activeTexture(u.TEXTURE0+(e||0)),u.bindTexture(u.TEXTURE_2D,this.id)},unbind:function(e){u.activeTexture(u.TEXTURE0+(e||0)),u.bindTexture(u.TEXTURE_2D,null)},drawTo:function(e,r){r=r||{};var o=u.getParameter(u.VIEWPORT);u.viewport(0,0,this.width,this.height),t=t||u.createFramebuffer(),u.bindFramebuffer(u.FRAMEBUFFER,t),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,this.id,0),!1!==r.depth&&(n=n||u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,n),this.width==n.width&&this.height==n.height||(n.width=this.width,n.height=this.height,u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,this.width,this.height)),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,n)),e(),u.bindFramebuffer(u.FRAMEBUFFER,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.viewport(o[0],o[1],o[2],o[3])},swapWith:function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t}},e.fromImage=function(t,n){n=n||{};var r=new e(t.width,t.height,n);try{u.texImage2D(u.TEXTURE_2D,0,r.format,r.format,r.type,t)}catch(e){throw"file:"==window.location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return n.minFilter&&n.minFilter!=u.NEAREST&&n.minFilter!=u.LINEAR&&u.generateMipmap(u.TEXTURE_2D),r},e.fromURL=function(t,n){r=r||function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var n=0;n<e.canvas.width;n+=16)e.fillStyle=16&(n^t)?"#FFF":"#DDD",e.fillRect(n,t,16,16);return e.canvas}();var o=e.fromImage(r,n),i=new Image,a=u;return i.onload=function(){a.makeCurrent(),e.fromImage(i,n).swapWith(o)},i.src=t,o},o.prototype={add:function(e){var t=JSON.stringify(e);return t in this.map||(this.map[t]=this.unique.length,this.unique.push(e)),this.map[t]}},i.prototype={compile:function(e){for(var t=[],n=0;n<this.data.length;n+=1e4)t=Array.prototype.concat.apply(t,this.data.slice(n,n+1e4));var r=this.data.length?t.length/this.data.length:0;if(r!=Math.round(r))throw"buffer elements not of consistent size, average size is "+r;this.buffer=this.buffer||u.createBuffer(),this.buffer.length=t.length,this.buffer.spacing=r,u.bindBuffer(this.target,this.buffer),u.bufferData(this.target,new this.type(t),e||u.STATIC_DRAW)}},a.prototype={addVertexBuffer:function(e,t){(this.vertexBuffers[t]=new i(u.ARRAY_BUFFER,Float32Array)).name=e,this[e]=[]},addIndexBuffer:function(e){this.indexBuffers[e]=new i(u.ELEMENT_ARRAY_BUFFER,Uint16Array),this[e]=[]},compile:function(){for(var e in this.vertexBuffers){(n=this.vertexBuffers[e]).data=this[n.name],n.compile()}for(var t in this.indexBuffers){var n;(n=this.indexBuffers[t]).data=this[t],n.compile()}},transform:function(e){if(this.vertices=this.vertices.map(function(t){return e.transformPoint(c.fromArray(t)).toArray()}),this.normals){var t=e.inverse().transpose();this.normals=this.normals.map(function(e){return t.transformVector(c.fromArray(e)).unit().toArray()})}return this.compile(),this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal");for(var e=0;e<this.vertices.length;e++)this.normals[e]=new c;for(e=0;e<this.triangles.length;e++){var t=this.triangles[e],n=c.fromArray(this.vertices[t[0]]),r=c.fromArray(this.vertices[t[1]]),o=c.fromArray(this.vertices[t[2]]),i=r.subtract(n).cross(o.subtract(n)).unit();this.normals[t[0]]=this.normals[t[0]].add(i),this.normals[t[1]]=this.normals[t[1]].add(i),this.normals[t[2]]=this.normals[t[2]].add(i)}for(e=0;e<this.vertices.length;e++)this.normals[e]=this.normals[e].unit().toArray();return this.compile(),this},computeWireframe:function(){for(var e=new o,t=0;t<this.triangles.length;t++)for(var n=this.triangles[t],r=0;r<n.length;r++){var i=n[r],a=n[(r+1)%n.length];e.add([Math.min(i,a),Math.max(i,a)])}return this.lines||this.addIndexBuffer("lines"),this.lines=e.unique,this.compile(),this},getAABB:function(){var e={min:new c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<this.vertices.length;t++){var n=c.fromArray(this.vertices[t]);e.min=c.min(e.min,n),e.max=c.max(e.max,n)}return e},getBoundingSphere:function(){for(var e=this.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0},n=0;n<this.vertices.length;n++)t.radius=Math.max(t.radius,c.fromArray(this.vertices[n]).subtract(t.center).length());return t}},a.plane=function(e){for(var t=new a(e=e||{}),n=e.detailX||e.detail||1,r=e.detailY||e.detail||1,o=0;o<=r;o++)for(var i=o/r,s=0;s<=n;s++){var l=s/n;if(t.vertices.push([2*l-1,2*i-1,0]),t.coords&&t.coords.push([l,i]),t.normals&&t.normals.push([0,0,1]),s<n&&o<r){var c=s+o*(n+1);t.triangles.push([c,c+1,c+n+1]),t.triangles.push([c+n+1,c+1,c+n+2])}}return t.compile(),t};var s=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];function l(e){return new c(2*(1&e)-1,(2&e)-1,(4&e)/2-1)}function c(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function d(e,t,n){for(var r;null!==(r=e.exec(t));)n(r)}a.cube=function(e){for(var t=new a(e),n=0;n<s.length;n++){for(var r=s[n],o=4*n,i=0;i<4;i++){var c=r[i];t.vertices.push(l(c).toArray()),t.coords&&t.coords.push([1&i,(2&i)/2]),t.normals&&t.normals.push(r.slice(4,7))}t.triangles.push([o,o+1,o+2]),t.triangles.push([o+2,o+1,o+3])}return t.compile(),t},a.sphere=function(e){function t(e,t,n){return f?[e,n,t]:[e,t,n]}function n(e){return e+(e-e*e)/2}for(var r=new a(e=e||{}),i=new o,s=e.detail||6,d=0;d<8;d++)for(var u=l(d),f=u.x*u.y*u.z>0,h=[],p=0;p<=s;p++){for(var g=0;p+g<=s;g++){var m=g/s,v=(s-p-g)/s,w={vertex:new c(n(y=p/s),n(m),n(v)).unit().multiply(u).toArray()};r.coords&&(w.coord=u.y>0?[1-y,v]:[v,1-y]),h.push(i.add(w))}if(p>0)for(g=0;p+g<=s;g++){var y=(p-1)*(s+1)+(p-1-(p-1)*(p-1))/2+g;m=p*(s+1)+(p-p*p)/2+g;r.triangles.push(t(h[y],h[y+1],h[m])),p+g<s&&r.triangles.push(t(h[m],h[y+1],h[m+1]))}}return r.vertices=i.unique.map(function(e){return e.vertex}),r.coords&&(r.coords=i.unique.map(function(e){return e.coord})),r.normals&&(r.normals=r.vertices),r.compile(),r},a.load=function(e,t){"coords"in(t=t||{})||(t.coords=!!e.coords),"normals"in t||(t.normals=!!e.normals),"colors"in t||(t.colors=!!e.colors),"triangles"in t||(t.triangles=!!e.triangles),"lines"in t||(t.lines=!!e.lines);var n=new a(t);return n.vertices=e.vertices,n.coords&&(n.coords=e.coords),n.normals&&(n.normals=e.normals),n.colors&&(n.colors=e.colors),n.triangles&&(n.triangles=e.triangles),n.lines&&(n.lines=e.lines),n.compile(),n},c.prototype={negative:function(){return new c(-this.x,-this.y,-this.z)},add:function(e){return e instanceof c?new c(this.x+e.x,this.y+e.y,this.z+e.z):new c(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof c?new c(this.x-e.x,this.y-e.y,this.z-e.z):new c(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof c?new c(this.x*e.x,this.y*e.y,this.z*e.z):new c(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof c?new c(this.x/e.x,this.y/e.y,this.z/e.z):new c(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new c(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new c(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},c.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},c.add=function(e,t,n){return t instanceof c?(n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z):(n.x=e.x+t,n.y=e.y+t,n.z=e.z+t),n},c.subtract=function(e,t,n){return t instanceof c?(n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z):(n.x=e.x-t,n.y=e.y-t,n.z=e.z-t),n},c.multiply=function(e,t,n){return t instanceof c?(n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z):(n.x=e.x*t,n.y=e.y*t,n.z=e.z*t),n},c.divide=function(e,t,n){return t instanceof c?(n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z):(n.x=e.x/t,n.y=e.y/t,n.z=e.z/t),n},c.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},c.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},c.fromAngles=function(e,t){return new c(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},c.randomDirection=function(){return c.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},c.min=function(e,t){return new c(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},c.max=function(e,t){return new c(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},c.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},c.fromArray=function(e){return new c(e[0],e[1],e[2])};var u,f="LIGHTGL";function h(e,t){function n(e){var t=document.getElementById(e);return t?t.text:e}var r="uniform mat3 gl_NormalMatrix;uniform mat4 gl_ModelViewMatrix;uniform mat4 gl_ProjectionMatrix;uniform mat4 gl_ModelViewProjectionMatrix;uniform mat4 gl_ModelViewMatrixInverse;uniform mat4 gl_ProjectionMatrixInverse;uniform mat4 gl_ModelViewProjectionMatrixInverse;",o=r+"attribute vec4 gl_Vertex;attribute vec4 gl_TexCoord;attribute vec3 gl_Normal;attribute vec4 gl_Color;vec4 ftransform() {  return gl_ModelViewProjectionMatrix * gl_Vertex;}",i="precision highp float;"+r,a=(e=n(e))+(t=n(t)),s={};function l(e,t){var n={},r=/^((\s*\/\/.*\n|\s*#extension.*\n)+)\^*$/.exec(t);return t=r?r[1]+e+t.substr(r[1].length):e+t,d(/\bgl_\w+\b/g,e,function(e){e in n||(t=t.replace(new RegExp("\\b"+e+"\\b","g"),f+e),n[e]=!0)}),t}function c(e,t){var n=u.createShader(e);if(u.shaderSource(n,t),u.compileShader(n),!u.getShaderParameter(n,u.COMPILE_STATUS))throw"compile error: "+u.getShaderInfoLog(n);return n}if(d(/\b(gl_[^;]*)\b;/g,r,function(e){var t=e[1];if(-1!=a.indexOf(t)){var n=t.replace(/[a-z_]/g,"");s[n]=f+t}}),-1!=a.indexOf("ftransform")&&(s.MVPM=f+"gl_ModelViewProjectionMatrix"),this.usedMatrices=s,e=l(o,e),t=l(i,t),this.program=u.createProgram(),u.attachShader(this.program,c(u.VERTEX_SHADER,e)),u.attachShader(this.program,c(u.FRAGMENT_SHADER,t)),u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw"link error: "+u.getProgramInfoLog(this.program);this.attributes={},this.uniformLocations={};var h={};d(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+t,function(e){h[e[2]]=1}),this.isSampler=h}function p(e){var t=Object.prototype.toString.call(e);return"[object Array]"==t||"[object Float32Array]"==t}function g(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t}h.prototype={uniforms:function(e){for(var t in u.useProgram(this.program),e){var n=this.uniformLocations[t]||u.getUniformLocation(this.program,t);if(n){this.uniformLocations[t]=n;var r=e[t];if(r instanceof c?r=[r.x,r.y,r.z]:r instanceof A&&(r=r.m),p(r))switch(r.length){case 1:u.uniform1fv(n,new Float32Array(r));break;case 2:u.uniform2fv(n,new Float32Array(r));break;case 3:u.uniform3fv(n,new Float32Array(r));break;case 4:u.uniform4fv(n,new Float32Array(r));break;case 9:u.uniformMatrix3fv(n,!1,new Float32Array([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]]));break;case 16:u.uniformMatrix4fv(n,!1,new Float32Array([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]]));break;default:throw"don't know how to load uniform \""+t+'" of length '+r.length}else{if(!g(r))throw'attempted to set uniform "'+t+'" to invalid value '+r;(this.isSampler[t]?u.uniform1i:u.uniform1f).call(u,n,r)}}}return this},draw:function(e,t){this.drawBuffers(e.vertexBuffers,e.indexBuffers[t==u.LINES?"lines":"triangles"],arguments.length<2?u.TRIANGLES:t)},drawBuffers:function(e,t,n){var r=this.usedMatrices,o=u.modelviewMatrix,i=u.projectionMatrix,a=r.MVMI||r.NM?o.inverse():null,s=r.PMI?i.inverse():null,l=r.MVPM||r.MVPMI?i.multiply(o):null,c={};if(r.MVM&&(c[r.MVM]=o),r.MVMI&&(c[r.MVMI]=a),r.PM&&(c[r.PM]=i),r.PMI&&(c[r.PMI]=s),r.MVPM&&(c[r.MVPM]=l),r.MVPMI&&(c[r.MVPMI]=l.inverse()),r.NM){var d=a.m;c[r.NM]=[d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]]}this.uniforms(c);var h=0;for(var p in e){var g=e[p],m=this.attributes[p]||u.getAttribLocation(this.program,p.replace(/^(gl_.*)$/,f+"$1"));-1!=m&&g.buffer&&(this.attributes[p]=m,u.bindBuffer(u.ARRAY_BUFFER,g.buffer),u.enableVertexAttribArray(m),u.vertexAttribPointer(m,g.buffer.spacing,u.FLOAT,!1,0,0),h=g.buffer.length/g.buffer.spacing)}for(var p in this.attributes)p in e||u.disableVertexAttribArray(this.attributes[p]);return!h||t&&!t.buffer||(t?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t.buffer),u.drawElements(n,t.buffer.length,u.UNSIGNED_SHORT,0)):u.drawArrays(n,0,h)),this}},h.fromURL=function(e,t){var n=function(e){var t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(null),200!==t.status)throw"could not load "+e;return t.responseText};return new h(n(e),n(t))},h.from=function(e,t){try{return new h(e,t)}catch(n){return h.fromURL(e,t)}};var m={create:function(e){var t,n,r=(e=e||{}).canvas;r||((r=document.createElement("canvas")).width=e.width||800,r.height=e.height||600),"alpha"in e||(e.alpha=!1);try{u=r.getContext("webgl",e)}catch(e){}try{u=u||r.getContext("experimental-webgl",e)}catch(e){}if(!u)throw"WebGL not supported";return function(){u.MODELVIEW=1|S,u.PROJECTION=2|S;var e=new A,t=new A;u.modelviewMatrix=new A,u.projectionMatrix=new A;var n,r,o=[],i=[];u.matrixMode=function(e){switch(e){case u.MODELVIEW:n="modelviewMatrix",r=o;break;case u.PROJECTION:n="projectionMatrix",r=i;break;default:throw"invalid matrix mode "+e}},u.loadIdentity=function(){A.identity(u[n])},u.loadMatrix=function(e){for(var t=e.m,r=u[n].m,o=0;o<16;o++)r[o]=t[o]},u.multMatrix=function(e){u.loadMatrix(A.multiply(u[n],e,t))},u.perspective=function(t,n,r,o){u.multMatrix(A.perspective(t,n,r,o,e))},u.frustum=function(t,n,r,o,i,a){u.multMatrix(A.frustum(t,n,r,o,i,a,e))},u.ortho=function(t,n,r,o,i,a){u.multMatrix(A.ortho(t,n,r,o,i,a,e))},u.scale=function(t,n,r){u.multMatrix(A.scale(t,n,r,e))},u.translate=function(t,n,r){u.multMatrix(A.translate(t,n,r,e))},u.rotate=function(t,n,r,o){u.multMatrix(A.rotate(t,n,r,o,e))},u.lookAt=function(t,n,r,o,i,a,s,l,c){u.multMatrix(A.lookAt(t,n,r,o,i,a,s,l,c,e))},u.pushMatrix=function(){r.push(Array.prototype.slice.call(u[n].m))},u.popMatrix=function(){var e=r.pop();u[n].m=x?new Float32Array(e):e},u.project=function(e,t,n,r,o,i){r=r||u.modelviewMatrix,o=o||u.projectionMatrix,i=i||u.getParameter(u.VIEWPORT);var a=o.transformPoint(r.transformPoint(new c(e,t,n)));return new c(i[0]+i[2]*(.5*a.x+.5),i[1]+i[3]*(.5*a.y+.5),.5*a.z+.5)},u.unProject=function(n,r,o,i,a,s){i=i||u.modelviewMatrix,a=a||u.projectionMatrix;var l=new c((n-(s=s||u.getParameter(u.VIEWPORT))[0])/s[2]*2-1,(r-s[1])/s[3]*2-1,2*o-1);return A.inverse(A.multiply(a,i,e),t).transformPoint(l)},u.matrixMode(u.MODELVIEW)}(),t={mesh:new a({coords:!0,colors:!0,triangles:!1}),mode:-1,coord:[0,0,0,0],color:[1,1,1,1],pointSize:1,shader:new h("uniform float pointSize;varying vec4 color;varying vec4 coord;void main() {color = gl_Color;coord = gl_TexCoord;gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;gl_PointSize = pointSize;}","uniform sampler2D texture;uniform float pointSize;uniform bool useTexture;varying vec4 color;varying vec4 coord;void main() {gl_FragColor = color;if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);}")},u.pointSize=function(e){t.shader.uniforms({pointSize:e})},u.begin=function(e){if(-1!=t.mode)throw"mismatched gl.begin() and gl.end() calls";t.mode=e,t.mesh.colors=[],t.mesh.coords=[],t.mesh.vertices=[]},u.color=function(e,n,r,o){t.color=1==arguments.length?e.toArray().concat(1):[e,n,r,o||1]},u.texCoord=function(e,n){t.coord=1==arguments.length?e.toArray(2):[e,n]},u.vertex=function(e,n,r){t.mesh.colors.push(t.color),t.mesh.coords.push(t.coord),t.mesh.vertices.push(1==arguments.length?e.toArray():[e,n,r])},u.end=function(){if(-1==t.mode)throw"mismatched gl.begin() and gl.end() calls";t.mesh.compile(),t.shader.uniforms({useTexture:!!u.getParameter(u.TEXTURE_BINDING_2D)}).draw(t.mesh,t.mode),t.mode=-1},function(){var e=u,t=0,n=0,r={},o=!1,i=Object.prototype.hasOwnProperty;function a(){for(var e in r)if(i.call(r,e)&&r[e])return!0;return!1}function s(e){var r={};for(var i in e)"function"==typeof e[i]?r[i]=function(t){return function(){t.apply(e,arguments)}}(e[i]):r[i]=e[i];r.original=e,r.x=r.pageX,r.y=r.pageY;for(var s=u.canvas;s;s=s.offsetParent)r.x-=s.offsetLeft,r.y-=s.offsetTop;return o?(r.deltaX=r.x-t,r.deltaY=r.y-n):(r.deltaX=0,r.deltaY=0,o=!0),t=r.x,n=r.y,r.dragging=a(),r.preventDefault=function(){r.original.preventDefault()},r.stopPropagation=function(){r.original.stopPropagation()},r}function l(e){var r={};for(var i in e)"function"==typeof e[i]?r[i]=function(t){return function(){t.apply(e,arguments)}}(e[i]):r[i]=e[i];if(r.original=e,r.targetTouches.length>0){var a=r.targetTouches[0];r.x=a.pageX,r.y=a.pageY;for(var s=u.canvas;s;s=s.offsetParent)r.x-=s.offsetLeft,r.y-=s.offsetTop;o?(r.deltaX=r.x-t,r.deltaY=r.y-n):(r.deltaX=0,r.deltaY=0,o=!0),t=r.x,n=r.y,r.dragging=!0}return r.preventDefault=function(){r.original.preventDefault()},r.stopPropagation=function(){r.original.stopPropagation()},r}function c(t){u=e,a()||(w(document,"mousemove",d),w(document,"mouseup",f),y(u.canvas,"mousemove",d),y(u.canvas,"mouseup",f)),r[t.which]=!0,t=s(t),u.onmousedown&&u.onmousedown(t),t.preventDefault()}function d(t){u=e,t=s(t),u.onmousemove&&u.onmousemove(t),t.preventDefault()}function f(t){u=e,r[t.which]=!1,a()||(y(document,"mousemove",d),y(document,"mouseup",f),w(u.canvas,"mousemove",d),w(u.canvas,"mouseup",f)),t=s(t),u.onmouseup&&u.onmouseup(t),t.preventDefault()}function h(t){u=e,t=s(t),u.onmousewheel&&u.onmousewheel(t),t.preventDefault()}function p(t){S(),w(document,"touchmove",g),w(document,"touchend",m),y(u.canvas,"touchmove",g),y(u.canvas,"touchend",m),u=e,t=l(t),u.ontouchstart&&u.ontouchstart(t),t.preventDefault()}function g(t){u=e,0===t.targetTouches.length&&m(t),t=l(t),u.ontouchmove&&u.ontouchmove(t),t.preventDefault()}function m(t){y(document,"touchmove",g),y(document,"touchend",m),w(u.canvas,"touchmove",g),w(u.canvas,"touchend",m),u=e,t=l(t),u.ontouchend&&u.ontouchend(t),t.preventDefault()}function v(){o=!1}function S(){r={},o=!1}w(u.canvas,"mousedown",c),w(u.canvas,"mousemove",d),w(u.canvas,"mouseup",f),w(u.canvas,"mousewheel",h),w(u.canvas,"DOMMouseScroll",h),w(u.canvas,"mouseover",v),w(u.canvas,"mouseout",v),w(u.canvas,"touchstart",p),w(u.canvas,"touchmove",g),w(u.canvas,"touchend",m),w(document,"contextmenu",S)}(),n=u,u.makeCurrent=function(){u=n},u.animate=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},t=(new Date).getTime(),n=u;function r(){u=n;var o=(new Date).getTime();u.onupdate&&u.onupdate((o-t)/1e3),u.ondraw&&u.ondraw(),e(r),t=o}r()},u.fullscreen=function(e){var t=(e=e||{}).paddingTop||0,n=e.paddingLeft||0,r=e.paddingRight||0,o=e.paddingBottom||0;if(!document.body)throw"document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)";function i(){u.canvas.width=window.innerWidth-n-r,u.canvas.height=window.innerHeight-t-o,u.viewport(0,0,u.canvas.width,u.canvas.height),!e.camera&&"camera"in e||(u.matrixMode(u.PROJECTION),u.loadIdentity(),u.perspective(e.fov||45,u.canvas.width/u.canvas.height,e.near||.1,e.far||1e3),u.matrixMode(u.MODELVIEW)),u.onresize&&u.onresize(),u.ondraw&&u.ondraw()}document.body.appendChild(u.canvas),document.body.style.overflow="hidden",u.canvas.style.position="absolute",u.canvas.style.left=n+"px",u.canvas.style.top=t+"px",w(window,"resize",i),i()},u},keys:{},Matrix:A,Indexer:o,Buffer:i,Mesh:a,HitTest:b,Raytracer:_,Shader:h,Texture:e,Vector:c};function v(e){return{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"}[e]||(e>=65&&e<=90?String.fromCharCode(e):null)}function w(e,t,n){e.addEventListener(t,n)}function y(e,t,n){e.removeEventListener(t,n)}w(document,"keydown",function(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey){var t=v(e.keyCode);t&&(m.keys[t]=!0),m.keys[e.keyCode]=!0}}),w(document,"keyup",function(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey){var t=v(e.keyCode);t&&(m.keys[t]=!1),m.keys[e.keyCode]=!1}});var S=305397760,x="undefined"!=typeof Float32Array;function A(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=x?new Float32Array(e):e}function b(e,t,n){this.t=arguments.length?e:Number.MAX_VALUE,this.hit=t,this.normal=n}function _(){var e=u.getParameter(u.VIEWPORT),t=u.modelviewMatrix.m,n=new c(t[0],t[4],t[8]),r=new c(t[1],t[5],t[9]),o=new c(t[2],t[6],t[10]),i=new c(t[3],t[7],t[11]);this.eye=new c(-i.dot(n),-i.dot(r),-i.dot(o));var a=e[0],s=a+e[2],l=e[1],d=l+e[3];this.ray00=u.unProject(a,l,1).subtract(this.eye),this.ray10=u.unProject(s,l,1).subtract(this.eye),this.ray01=u.unProject(a,d,1).subtract(this.eye),this.ray11=u.unProject(s,d,1).subtract(this.eye),this.viewport=e}return A.prototype={inverse:function(){return A.inverse(this,new A)},transpose:function(){return A.transpose(this,new A)},multiply:function(e){return A.multiply(this,e,new A)},transformPoint:function(e){var t=this.m;return new c(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11]).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new c(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},A.inverse=function(e,t){t=t||new A;var n=e.m,r=t.m;r[0]=n[5]*n[10]*n[15]-n[5]*n[14]*n[11]-n[6]*n[9]*n[15]+n[6]*n[13]*n[11]+n[7]*n[9]*n[14]-n[7]*n[13]*n[10],r[1]=-n[1]*n[10]*n[15]+n[1]*n[14]*n[11]+n[2]*n[9]*n[15]-n[2]*n[13]*n[11]-n[3]*n[9]*n[14]+n[3]*n[13]*n[10],r[2]=n[1]*n[6]*n[15]-n[1]*n[14]*n[7]-n[2]*n[5]*n[15]+n[2]*n[13]*n[7]+n[3]*n[5]*n[14]-n[3]*n[13]*n[6],r[3]=-n[1]*n[6]*n[11]+n[1]*n[10]*n[7]+n[2]*n[5]*n[11]-n[2]*n[9]*n[7]-n[3]*n[5]*n[10]+n[3]*n[9]*n[6],r[4]=-n[4]*n[10]*n[15]+n[4]*n[14]*n[11]+n[6]*n[8]*n[15]-n[6]*n[12]*n[11]-n[7]*n[8]*n[14]+n[7]*n[12]*n[10],r[5]=n[0]*n[10]*n[15]-n[0]*n[14]*n[11]-n[2]*n[8]*n[15]+n[2]*n[12]*n[11]+n[3]*n[8]*n[14]-n[3]*n[12]*n[10],r[6]=-n[0]*n[6]*n[15]+n[0]*n[14]*n[7]+n[2]*n[4]*n[15]-n[2]*n[12]*n[7]-n[3]*n[4]*n[14]+n[3]*n[12]*n[6],r[7]=n[0]*n[6]*n[11]-n[0]*n[10]*n[7]-n[2]*n[4]*n[11]+n[2]*n[8]*n[7]+n[3]*n[4]*n[10]-n[3]*n[8]*n[6],r[8]=n[4]*n[9]*n[15]-n[4]*n[13]*n[11]-n[5]*n[8]*n[15]+n[5]*n[12]*n[11]+n[7]*n[8]*n[13]-n[7]*n[12]*n[9],r[9]=-n[0]*n[9]*n[15]+n[0]*n[13]*n[11]+n[1]*n[8]*n[15]-n[1]*n[12]*n[11]-n[3]*n[8]*n[13]+n[3]*n[12]*n[9],r[10]=n[0]*n[5]*n[15]-n[0]*n[13]*n[7]-n[1]*n[4]*n[15]+n[1]*n[12]*n[7]+n[3]*n[4]*n[13]-n[3]*n[12]*n[5],r[11]=-n[0]*n[5]*n[11]+n[0]*n[9]*n[7]+n[1]*n[4]*n[11]-n[1]*n[8]*n[7]-n[3]*n[4]*n[9]+n[3]*n[8]*n[5],r[12]=-n[4]*n[9]*n[14]+n[4]*n[13]*n[10]+n[5]*n[8]*n[14]-n[5]*n[12]*n[10]-n[6]*n[8]*n[13]+n[6]*n[12]*n[9],r[13]=n[0]*n[9]*n[14]-n[0]*n[13]*n[10]-n[1]*n[8]*n[14]+n[1]*n[12]*n[10]+n[2]*n[8]*n[13]-n[2]*n[12]*n[9],r[14]=-n[0]*n[5]*n[14]+n[0]*n[13]*n[6]+n[1]*n[4]*n[14]-n[1]*n[12]*n[6]-n[2]*n[4]*n[13]+n[2]*n[12]*n[5],r[15]=n[0]*n[5]*n[10]-n[0]*n[9]*n[6]-n[1]*n[4]*n[10]+n[1]*n[8]*n[6]+n[2]*n[4]*n[9]-n[2]*n[8]*n[5];for(var o=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+n[3]*r[12],i=0;i<16;i++)r[i]/=o;return t},A.transpose=function(e,t){t=t||new A;var n=e.m,r=t.m;return r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15],t},A.multiply=function(e,t,n){n=n||new A;var r=e.m,o=t.m,i=n.m;return i[0]=r[0]*o[0]+r[1]*o[4]+r[2]*o[8]+r[3]*o[12],i[1]=r[0]*o[1]+r[1]*o[5]+r[2]*o[9]+r[3]*o[13],i[2]=r[0]*o[2]+r[1]*o[6]+r[2]*o[10]+r[3]*o[14],i[3]=r[0]*o[3]+r[1]*o[7]+r[2]*o[11]+r[3]*o[15],i[4]=r[4]*o[0]+r[5]*o[4]+r[6]*o[8]+r[7]*o[12],i[5]=r[4]*o[1]+r[5]*o[5]+r[6]*o[9]+r[7]*o[13],i[6]=r[4]*o[2]+r[5]*o[6]+r[6]*o[10]+r[7]*o[14],i[7]=r[4]*o[3]+r[5]*o[7]+r[6]*o[11]+r[7]*o[15],i[8]=r[8]*o[0]+r[9]*o[4]+r[10]*o[8]+r[11]*o[12],i[9]=r[8]*o[1]+r[9]*o[5]+r[10]*o[9]+r[11]*o[13],i[10]=r[8]*o[2]+r[9]*o[6]+r[10]*o[10]+r[11]*o[14],i[11]=r[8]*o[3]+r[9]*o[7]+r[10]*o[11]+r[11]*o[15],i[12]=r[12]*o[0]+r[13]*o[4]+r[14]*o[8]+r[15]*o[12],i[13]=r[12]*o[1]+r[13]*o[5]+r[14]*o[9]+r[15]*o[13],i[14]=r[12]*o[2]+r[13]*o[6]+r[14]*o[10]+r[15]*o[14],i[15]=r[12]*o[3]+r[13]*o[7]+r[14]*o[11]+r[15]*o[15],n},A.identity=function(e){var t=(e=e||new A).m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},A.perspective=function(e,t,n,r,o){var i=Math.tan(e*Math.PI/360)*n,a=i*t;return A.frustum(-a,a,-i,i,n,r,o)},A.frustum=function(e,t,n,r,o,i,a){var s=(a=a||new A).m;return s[0]=2*o/(t-e),s[1]=0,s[2]=(t+e)/(t-e),s[3]=0,s[4]=0,s[5]=2*o/(r-n),s[6]=(r+n)/(r-n),s[7]=0,s[8]=0,s[9]=0,s[10]=-(i+o)/(i-o),s[11]=-2*i*o/(i-o),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,a},A.ortho=function(e,t,n,r,o,i,a){var s=(a=a||new A).m;return s[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=-(t+e)/(t-e),s[4]=0,s[5]=2/(r-n),s[6]=0,s[7]=-(r+n)/(r-n),s[8]=0,s[9]=0,s[10]=-2/(i-o),s[11]=-(i+o)/(i-o),s[12]=0,s[13]=0,s[14]=0,s[15]=1,a},A.scale=function(e,t,n,r){var o=(r=r||new A).m;return o[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r},A.translate=function(e,t,n,r){var o=(r=r||new A).m;return o[0]=1,o[1]=0,o[2]=0,o[3]=e,o[4]=0,o[5]=1,o[6]=0,o[7]=t,o[8]=0,o[9]=0,o[10]=1,o[11]=n,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r},A.rotate=function(e,t,n,r,o){if(!e||!t&&!n&&!r)return A.identity(o);var i=(o=o||new A).m,a=Math.sqrt(t*t+n*n+r*r);e*=Math.PI/180,t/=a,n/=a,r/=a;var s=Math.cos(e),l=Math.sin(e),c=1-s;return i[0]=t*t*c+s,i[1]=t*n*c-r*l,i[2]=t*r*c+n*l,i[3]=0,i[4]=n*t*c+r*l,i[5]=n*n*c+s,i[6]=n*r*c-t*l,i[7]=0,i[8]=r*t*c-n*l,i[9]=r*n*c+t*l,i[10]=r*r*c+s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,o},A.lookAt=function(e,t,n,r,o,i,a,s,l,d){var u=(d=d||new A).m,f=new c(e,t,n),h=new c(r,o,i),p=new c(a,s,l),g=f.subtract(h).unit(),m=p.cross(g).unit(),v=g.cross(m).unit();return u[0]=m.x,u[1]=m.y,u[2]=m.z,u[3]=-m.dot(f),u[4]=v.x,u[5]=v.y,u[6]=v.z,u[7]=-v.dot(f),u[8]=g.x,u[9]=g.y,u[10]=g.z,u[11]=-g.dot(f),u[12]=0,u[13]=0,u[14]=0,u[15]=1,d},b.prototype={mergeWith:function(e){e.t>0&&e.t<this.t&&(this.t=e.t,this.hit=e.hit,this.normal=e.normal)}},_.prototype={getRayForPixel:function(e,t){e=(e-this.viewport[0])/this.viewport[2],t=1-(t-this.viewport[1])/this.viewport[3];var n=c.lerp(this.ray00,this.ray10,e),r=c.lerp(this.ray01,this.ray11,e);return c.lerp(n,r,t).unit()}},_.hitTestBox=function(e,t,n,r){var o=n.subtract(e).divide(t),i=r.subtract(e).divide(t),a=c.min(o,i),s=c.max(o,i),l=a.max(),d=s.min();if(l>0&&l<d){var u=1e-6,f=e.add(t.multiply(l));return n=n.add(u),r=r.subtract(u),new b(l,f,new c((f.x>r.x)-(f.x<n.x),(f.y>r.y)-(f.y<n.y),(f.z>r.z)-(f.z<n.z)))}return null},_.hitTestSphere=function(e,t,n,r){var o=e.subtract(n),i=t.dot(t),a=2*t.dot(o),s=a*a-4*i*(o.dot(o)-r*r);if(s>0){var l=(-a-Math.sqrt(s))/(2*i),c=e.add(t.multiply(l));return new b(l,c,c.subtract(n).divide(r))}return null},_.hitTestTriangle=function(e,t,n,r,o){var i=r.subtract(n),a=o.subtract(n),s=i.cross(a).unit(),l=s.dot(n.subtract(e))/s.dot(t);if(l>0){var c=e.add(t.multiply(l)),d=c.subtract(n),u=a.dot(a),f=a.dot(i),h=a.dot(d),p=i.dot(i),g=i.dot(d),m=u*p-f*f,v=(p*h-f*g)/m,w=(u*g-f*h)/m;if(v>=0&&w>=0&&v+w<=1)return new b(l,c,s)}return null},m}();function importSTL(e,t){for(var n=!0,r=0;r<e.length;r++)if(0==e[r].charCodeAt(0)){n=!1;break}return console.log("STL file is ascii: ",n),n?importAsciiSTL(e,t):importBinarySTL(e,t)}function importBinarySTL(e,t){var n=[],r=new BinaryReader(e);r.seek(80);for(var o=r.readUInt32(),i=[1e4,1e4,1e4],a=[-1e4,-1e4,-1e4],s=0;s<o;s++){r.readFloat(),r.readFloat(),r.readFloat();var l=[];l.push(r.readFloat()),l.push(r.readFloat()),l.push(r.readFloat());var c=[];c.push(r.readFloat()),c.push(r.readFloat()),c.push(r.readFloat());var d=[];d.push(r.readFloat()),d.push(r.readFloat()),d.push(r.readFloat());for(var u=0,f=0;f<3;f++)isNaN(l[f])&&u++,isNaN(c[f])&&u++,isNaN(d[f])&&u++;if(u>0&&console.log("this many bad vertices: ",u),r.readUInt16(),!u){n.push(l),n.push(c),n.push(d);for(f=0;f<3;f++)i[f]=Math.min(i[f],l[f]),i[f]=Math.min(i[f],c[f]),i[f]=Math.min(i[f],d[f]),a[f]=Math.max(a[f],l[f]),a[f]=Math.max(a[f],c[f]),a[f]=Math.max(a[f],d[f])}}u&&console.log("WARNING: import errors: expect some missing or bad triangles\n");var h=[Math.round(a[0]-(a[0]-i[0])/2),Math.round(a[1]-(a[1]-i[1])/2),Math.round(a[2]-(a[2]-i[2])/2)];return[vt2csg(n),h]}function importAsciiSTL(e,t){for(var n="",r=[],o=0,i=0,a=[1e4,1e4,1e4],s=[-1e4,-1e4,-1e4],l=e.split("\n"),c=0;c<l.length;c++)if(!l[c].match(/facet/)&&!l[c].match(/endloop/))if(l[c].match(/outer/)){i=0,o=0;var d=[];d[0]=[],d[1]=[],d[2]=[]}else if(l[c].match(/vertex/)){l[c]=l[c].replace(/^\s+|\s+$/g,"");var u=l[c].split(" ");if(d[i].push(parseFloat(u[1])),d[i].push(parseFloat(u[2])),d[i].push(parseFloat(u[3])),isNaN(d[i][0])&&o++,isNaN(d[i][1])&&o++,isNaN(d[i][2])&&o++,o>0&&(console.log("this many bad vertices: ",o),console.log("things are:",u)),!o&&3==++i){r.push(d[0]),r.push(d[1]),r.push(d[2]);for(var f=0;f<3;f++)a[f]=Math.min(a[f],d[0][f]),a[f]=Math.min(a[f],d[1][f]),a[f]=Math.min(a[f],d[2][f]),s[f]=Math.max(s[f],d[0][f]),s[f]=Math.max(s[f],d[1][f]),s[f]=Math.max(s[f],d[2][f])}}else;var h=[Math.round(s[0]-(s[0]-a[0])/2),Math.round(s[1]-(s[1]-a[1])/2),Math.round(s[2]-(s[2]-a[2])/2)];return[n+=vt2csg(r),h]}function vt2csg(e){var t="";t+="CSG.fromPolygons([";for(var n=0;n<e.length/3;n++){t+="new CSG.Polygon([";for(var r=0;r<3;r++)t+="new CSG.Vertex(new CSG.Vector3D([",t+=e[3*n+r]+"]))",r<2&&(t+=",");t+="])",n<e.length/3-1&&(t+=",")}return t+="])"}!function(e){var t,n,r,o,i,a,s,l,c,d,u,f,h,p,g,m,v,w=null,y=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),S=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),x=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),A=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),b=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),_=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),B=function(){this.next=null,this.list=null},O=function(){this.e=0,this.b=0,this.n=0,this.t=null},C=function(e,t,n,r,o,i){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var a,s,l,c,d,u,f,h,p,g,m,v,w,y,S,x,A,b=new Array(this.BMAX+1),_=new Array(this.BMAX+1),C=new O,M=new Array(this.BMAX),E=new Array(this.N_MAX),D=new Array(this.BMAX+1);for(A=this.root=null,u=0;u<b.length;u++)b[u]=0;for(u=0;u<_.length;u++)_[u]=0;for(u=0;u<M.length;u++)M[u]=null;for(u=0;u<E.length;u++)E[u]=0;for(u=0;u<D.length;u++)D[u]=0;s=t>256?e[256]:this.BMAX,p=e,g=0,u=t;do{b[p[g]]++,g++}while(--u>0);if(b[0]==t)return this.root=null,this.m=0,void(this.status=0);for(f=1;f<=this.BMAX&&0==b[f];f++);for(h=f,i<f&&(i=f),u=this.BMAX;0!=u&&0==b[u];u--);for(c=u,i>u&&(i=u),y=1<<f;f<u;f++,y<<=1)if((y-=b[f])<0)return this.status=2,void(this.m=i);if((y-=b[u])<0)return this.status=2,void(this.m=i);for(b[u]+=y,D[1]=f=0,p=b,g=1,w=2;--u>0;)D[w++]=f+=p[g++];p=e,g=0,u=0;do{0!=(f=p[g++])&&(E[D[f]++]=u)}while(++u<t);for(t=D[c],D[0]=u=0,p=E,g=0,d=-1,v=_[0]=0,m=null,S=0;h<=c;h++)for(a=b[h];a-- >0;){for(;h>v+_[1+d];){if(v+=_[1+d],d++,S=(S=c-v)>i?i:S,(l=1<<(f=h-v))>a+1)for(l-=a+1,w=h;++f<S&&!((l<<=1)<=b[++w]);)l-=b[w];for(v+f>s&&v<s&&(f=s-v),S=1<<f,_[1+d]=f,m=new Array(S),x=0;x<S;x++)m[x]=new O;(A=null==A?this.root=new B:A.next=new B).next=null,A.list=m,M[d]=m,d>0&&(D[d]=u,C.b=_[d],C.e=16+f,C.t=m,f=(u&(1<<v)-1)>>v-_[d],M[d-1][f].e=C.e,M[d-1][f].b=C.b,M[d-1][f].n=C.n,M[d-1][f].t=C.t)}for(C.b=h-v,g>=t?C.e=99:p[g]<n?(C.e=p[g]<256?16:15,C.n=p[g++]):(C.e=o[p[g]-n],C.n=r[p[g++]-n]),l=1<<h-v,f=u>>v;f<S;f+=l)m[f].e=C.e,m[f].b=C.b,m[f].n=C.n,m[f].t=C.t;for(f=1<<h-1;0!=(u&f);f>>=1)u^=f;for(u^=f;(u&(1<<v)-1)!=D[d];)v-=_[d],d--}this.m=_[1],this.status=0!=y&&1!=c?1:0},M=function(){return m.length==v?-1:255&m.charCodeAt(v++)},E=function(e){for(;s<e;)a|=M()<<s,s+=8},D=function(e){return a&y[e]},T=function(e){a>>=e,s-=e},U=function(e,r,o){var i,a,s;if(0==o)return 0;for(s=0;;){for(E(p),i=(a=f.list[D(p)]).e;i>16;){if(99==i)return-1;T(a.b),E(i-=16),i=(a=a.t[D(i)]).e}if(T(a.b),16!=i){if(15==i)break;for(E(i),d=a.n+D(i),T(i),E(g),i=(a=h.list[D(g)]).e;i>16;){if(99==i)return-1;T(a.b),E(i-=16),i=(a=a.t[D(i)]).e}for(T(a.b),E(i),u=n-a.n-D(i),T(i);d>0&&s<o;)d--,u&=32767,n&=32767,e[r+s++]=t[n++]=t[u++];if(s==o)return o}else if(n&=32767,e[r+s++]=t[n++]=a.n,s==o)return o}return l=-1,s},R=function(e,r,o){var i;if(T(i=7&s),E(16),i=D(16),T(16),E(16),i!=(65535&~a))return-1;for(T(16),d=i,i=0;d>0&&i<o;)d--,n&=32767,E(8),e[r+i++]=t[n++]=D(8),T(8);return 0==d&&(l=-1),i},k=function(e,t,n){if(null==w){var a,s,l=new Array(288);for(a=0;a<144;a++)l[a]=8;for(;a<256;a++)l[a]=9;for(;a<280;a++)l[a]=7;for(;a<288;a++)l[a]=8;if(0!=(s=new C(l,288,257,S,x,o=7)).status)return alert("HufBuild error: "+s.status),-1;for(w=s.root,o=s.m,a=0;a<30;a++)l[a]=5;if((s=new C(l,30,0,A,b,i=5)).status>1)return w=null,alert("HufBuild error: "+s.status),-1;r=s.root,i=s.m}return f=w,h=r,p=o,g=i,U(e,t,n)},L=function(e,t,n){var r,o,i,a,s,l,c,d,u,m=new Array(316);for(r=0;r<m.length;r++)m[r]=0;if(E(5),c=257+D(5),T(5),E(5),d=1+D(5),T(5),E(4),l=4+D(4),T(4),c>286||d>30)return-1;for(o=0;o<l;o++)E(3),m[_[o]]=D(3),T(3);for(;o<19;o++)m[_[o]]=0;if(0!=(u=new C(m,19,19,null,null,p=7)).status)return-1;for(f=u.root,p=u.m,a=c+d,r=i=0;r<a;)if(E(p),o=(s=f.list[D(p)]).b,T(o),(o=s.n)<16)m[r++]=i=o;else if(16==o){if(E(2),o=3+D(2),T(2),r+o>a)return-1;for(;o-- >0;)m[r++]=i}else if(17==o){if(E(3),o=3+D(3),T(3),r+o>a)return-1;for(;o-- >0;)m[r++]=0;i=0}else{if(E(7),o=11+D(7),T(7),r+o>a)return-1;for(;o-- >0;)m[r++]=0;i=0}if(u=new C(m,c,257,S,x,p=9),0==p&&(u.status=1),0!=u.status&&1==u.status)return-1;for(f=u.root,p=u.m,r=0;r<d;r++)m[r]=m[r+c];return u=new C(m,d,0,A,b,g=6),h=u.root,0==(g=u.m)&&c>257||0!=u.status?-1:U(e,t,n)},I=function(e,r,o){var i,a;for(i=0;i<o;){if(c&&-1==l)return i;if(d>0){if(0!=l)for(;d>0&&i<o;)d--,u&=32767,n&=32767,e[r+i++]=t[n++]=t[u++];else{for(;d>0&&i<o;)d--,n&=32767,E(8),e[r+i++]=t[n++]=D(8),T(8);0==d&&(l=-1)}if(i==o)return i}if(-1==l){if(c)break;E(1),0!=D(1)&&(c=!0),T(1),E(2),l=D(2),T(2),f=null,d=0}switch(l){case 0:a=R(e,r+i,o-i);break;case 1:a=null!=f?U(e,r+i,o-i):k(e,r+i,o-i);break;case 2:a=null!=f?U(e,r+i,o-i):L(e,r+i,o-i);break;default:a=-1}if(-1==a)return c?0:-1;i+=a}return i};e.RawDeflate||(e.RawDeflate={}),e.RawDeflate.inflate=function(e){var r,o;null==t&&(t=new Array(65536)),n=0,a=0,s=0,l=-1,c=!1,d=u=0,f=null,m=e,v=0;for(var i=new Array(1024),h=[];(r=I(i,0,i.length))>0;){var p=new Array(r);for(o=0;o<r;o++)p[o]=String.fromCharCode(i[o]);h[h.length]=p.join("")}return m=null,h.join("")}}(this),function(e){var t=32768,n=8192,r=258,o=8192;var i,a,s,l,c,d,u,f,h,p,g,m,v,w,y,S,x,A,b,_,B,O,C,M,E,D,T,U,R,k,L,I,N,P,z,F,V,X,j,W,G,H,K,Y,q,$,J,Z,Q,ee,te,ne,re,oe,ie,ae=o,se=8192,le=8191,ce=262,de=32506,ue=15,fe=256,he=286,pe=30,ge=573,me=parseInt(5),ve=null,we=function(){this.fc=0,this.dl=0},ye=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Se=function(e,t,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r},xe=function(){this.next=null,this.len=0,this.ptr=new Array(n),this.off=0},Ae=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),be=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),_e=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),Be=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),Oe=new Array(new Se(0,0,0,0),new Se(4,4,8,4),new Se(4,5,16,8),new Se(4,6,32,32),new Se(4,4,16,16),new Se(8,16,32,32),new Se(8,16,128,128),new Se(8,32,128,256),new Se(32,128,258,1024),new Se(32,258,258,4096)),Ce=function(e){e.next=i,i=e},Me=function(e){return g[t+e]},Ee=function(e,n){return g[t+e]=n},De=function(e){ve[d+c++]=e,d+c==n&&tt()},Te=function(e){e&=65535,d+c<8190?(ve[d+c++]=255&e,ve[d+c++]=e>>>8):(De(255&e),De(e>>>8))},Ue=function(){y=(y<<me^255&f[B+3-1])&le,S=Me(y),g[32767&B]=S,Ee(y,B)},Re=function(e,t){Ze(t[e].fc,t[e].dl)},ke=function(e){return 255&(e<256?K[e]:K[256+(e>>7)])},Le=function(e,t,n){return e[t].fc<e[n].fc||e[t].fc==e[n].fc&&G[t]<=G[n]},Ie=function(e,t,n){var r;for(r=0;r<n&&ie<oe.length;r++)e[t+r]=255&oe.charCodeAt(ie++);return r},Ne=function(e){var t,n,o=E,i=B,a=_,s=B>de?B-de:0,l=B+r,c=f[i+a-1],d=f[i+a];_>=U&&(o>>=2);do{if(f[(t=e)+a]==d&&f[t+a-1]==c&&f[t]==f[i]&&f[++t]==f[i+1]){i+=2,t++;do{}while(f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&f[++i]==f[++t]&&i<l);if(n=r-(l-i),i=l-r,n>a){if(O=e,a=n,n>=r)break;c=f[i+a-1],d=f[i+a]}}}while((e=g[32767&e])>s&&0!=--o);return a},Pe=function(){var e,n,r=65536-M-B;if(-1==r)r--;else if(B>=65274){for(e=0;e<t;e++)f[e]=f[e+t];for(O-=t,B-=t,w-=t,e=0;e<se;e++)n=Me(e),Ee(e,n>=t?n-t:0);for(e=0;e<t;e++)n=g[e],g[e]=n>=t?n-t:0;r+=t}C||((e=Ie(f,B+M,r))<=0?C=!0:M+=e)},ze=function(){C||(m=0,v=0,Xe(),function(){var e;for(e=0;e<se;e++)g[t+e]=0;if(D=Oe[T].max_lazy,U=Oe[T].good_length,E=Oe[T].max_chain,B=0,w=0,(M=Ie(f,0,65536))<=0)return C=!0,void(M=0);for(C=!1;M<ce&&!C;)Pe();for(y=0,e=0;e<2;e++)y=(y<<me^255&f[e])&le}(),a=null,c=0,d=0,A=0,T<=3?(_=2,b=0):(b=2,A=0,A=0),u=!1)},Fe=function(e,t,n){var r;return l||(ze(),l=!0,0!=M)?(r=Ve(e,t,n))==n?n:u?r:(T<=3?function(){for(;0!=M&&null==a;){var e;if(Ue(),0!=S&&B-S<=de&&(b=Ne(S))>M&&(b=M),b>=3)if(e=$e(B-O,b-3),M-=b,b<=D){b--;do{B++,Ue()}while(0!=--b);B++}else B+=b,b=0,y=((y=255&f[B])<<me^255&f[B+1])&le;else e=$e(0,255&f[B]),M--,B++;for(e&&(qe(0),w=B);M<ce&&!C;)Pe()}}():function(){for(;0!=M&&null==a;){if(Ue(),_=b,x=O,b=2,0!=S&&_<D&&B-S<=de&&((b=Ne(S))>M&&(b=M),3==b&&B-O>4096&&b--),_>=3&&b<=_){var e;e=$e(B-1-x,_-3),M-=_-1,_-=2;do{B++,Ue()}while(0!=--_);A=0,b=2,B++,e&&(qe(0),w=B)}else 0!=A?($e(0,255&f[B-1])&&(qe(0),w=B),B++,M--):(A=1,B++,M--);for(;M<ce&&!C;)Pe()}}(),0==M&&(0!=A&&$e(0,255&f[B-1]),qe(1),u=!0),r+Ve(e,r+t,n-r)):(u=!0,0)},Ve=function(e,t,n){var r,o,i;for(r=0;null!=a&&r<n;){for((o=n-r)>a.len&&(o=a.len),i=0;i<o;i++)e[t+r+i]=a.ptr[a.off+i];var s;if(a.off+=o,a.len-=o,r+=o,0==a.len)s=a,a=a.next,Ce(s)}if(r==n)return r;if(d<c){for((o=n-r)>c-d&&(o=c-d),i=0;i<o;i++)e[t+r+i]=ve[d+i];r+=o,c==(d+=o)&&(c=d=0)}return r},Xe=function(){var e,t,n,r,o;if(0==I[0].dl){for(P.dyn_tree=R,P.static_tree=L,P.extra_bits=Ae,P.extra_base=257,P.elems=he,P.max_length=ue,P.max_code=0,z.dyn_tree=k,z.static_tree=I,z.extra_bits=be,z.extra_base=0,z.elems=pe,z.max_length=ue,z.max_code=0,F.dyn_tree=N,F.static_tree=null,F.extra_bits=_e,F.extra_base=0,F.elems=19,F.max_length=7,F.max_code=0,n=0,r=0;r<28;r++)for(Y[r]=n,e=0;e<1<<Ae[r];e++)H[n++]=r;for(H[n-1]=r,o=0,r=0;r<16;r++)for(q[r]=o,e=0;e<1<<be[r];e++)K[o++]=r;for(o>>=7;r<pe;r++)for(q[r]=o<<7,e=0;e<1<<be[r]-7;e++)K[256+o++]=r;for(t=0;t<=ue;t++)V[t]=0;for(e=0;e<=143;)L[e++].dl=8,V[8]++;for(;e<=255;)L[e++].dl=9,V[9]++;for(;e<=279;)L[e++].dl=7,V[7]++;for(;e<=287;)L[e++].dl=8,V[8]++;for(Ge(L,287),e=0;e<pe;e++)I[e].dl=5,I[e].fc=Qe(e,5);je()}},je=function(){var e;for(e=0;e<he;e++)R[e].fc=0;for(e=0;e<pe;e++)k[e].fc=0;for(e=0;e<19;e++)N[e].fc=0;R[256].fc=1,ne=re=0,J=Z=Q=0,ee=0,te=1},We=function(e,t){for(var n=X[t],r=t<<1;r<=j&&(r<j&&Le(e,X[r+1],X[r])&&r++,!Le(e,n,X[r]));)X[t]=X[r],t=r,r<<=1;X[t]=n},Ge=function(e,t){var n,r,o=new Array(16),i=0;for(n=1;n<=ue;n++)i=i+V[n-1]<<1,o[n]=i;for(r=0;r<=t;r++){var a=e[r].dl;0!=a&&(e[r].fc=Qe(o[a]++,a))}},He=function(e){var t,n,r=e.dyn_tree,o=e.static_tree,i=e.elems,a=-1,s=i;for(j=0,W=ge,t=0;t<i;t++)0!=r[t].fc?(X[++j]=a=t,G[t]=0):r[t].dl=0;for(;j<2;){var l=X[++j]=a<2?++a:0;r[l].fc=1,G[l]=0,ne--,null!=o&&(re-=o[l].dl)}for(e.max_code=a,t=j>>1;t>=1;t--)We(r,t);do{t=X[1],X[1]=X[j--],We(r,1),n=X[1],X[--W]=t,X[--W]=n,r[s].fc=r[t].fc+r[n].fc,G[t]>G[n]+1?G[s]=G[t]:G[s]=G[n]+1,r[t].dl=r[n].dl=s,X[1]=s++,We(r,1)}while(j>=2);X[--W]=X[1],function(e){var t,n,r,o,i,a,s=e.dyn_tree,l=e.extra_bits,c=e.extra_base,d=e.max_code,u=e.max_length,f=e.static_tree,h=0;for(o=0;o<=ue;o++)V[o]=0;for(s[X[W]].dl=0,t=W+1;t<ge;t++)(o=s[s[n=X[t]].dl].dl+1)>u&&(o=u,h++),s[n].dl=o,n>d||(V[o]++,i=0,n>=c&&(i=l[n-c]),a=s[n].fc,ne+=a*(o+i),null!=f&&(re+=a*(f[n].dl+i)));if(0!=h){do{for(o=u-1;0==V[o];)o--;V[o]--,V[o+1]+=2,V[u]--,h-=2}while(h>0);for(o=u;0!=o;o--)for(n=V[o];0!=n;)(r=X[--t])>d||(s[r].dl!=o&&(ne+=(o-s[r].dl)*s[r].fc,s[r].fc=o),n--)}}(e),Ge(r,a)},Ke=function(e,t){var n,r,o=-1,i=e[0].dl,a=0,s=7,l=4;for(0==i&&(s=138,l=3),e[t+1].dl=65535,n=0;n<=t;n++)r=i,i=e[n+1].dl,++a<s&&r==i||(a<l?N[r].fc+=a:0!=r?(r!=o&&N[r].fc++,N[16].fc++):a<=10?N[17].fc++:N[18].fc++,a=0,o=r,0==i?(s=138,l=3):r==i?(s=6,l=3):(s=7,l=4))},Ye=function(e,t){var n,r,o=-1,i=e[0].dl,a=0,s=7,l=4;for(0==i&&(s=138,l=3),n=0;n<=t;n++)if(r=i,i=e[n+1].dl,!(++a<s&&r==i)){if(a<l)do{Re(r,N)}while(0!=--a);else 0!=r?(r!=o&&(Re(r,N),a--),Re(16,N),Ze(a-3,2)):a<=10?(Re(17,N),Ze(a-3,3)):(Re(18,N),Ze(a-11,7));a=0,o=r,0==i?(s=138,l=3):r==i?(s=6,l=3):(s=7,l=4)}},qe=function(e){var t,n,r,o,i;if(o=B-w,$[Q]=ee,He(P),He(z),r=function(){var e;for(Ke(R,P.max_code),Ke(k,z.max_code),He(F),e=18;e>=3&&0==N[Be[e]].dl;e--);return ne+=3*(e+1)+5+5+4,e}(),(n=re+3+7>>3)<=(t=ne+3+7>>3)&&(t=n),o+4<=t&&w>=0)for(Ze(0+e,3),et(),Te(o),Te(~o),i=0;i<o;i++)De(f[w+i]);else n==t?(Ze(2+e,3),Je(L,I)):(Ze(4+e,3),function(e,t,n){var r;for(Ze(e-257,5),Ze(t-1,5),Ze(n-4,4),r=0;r<n;r++)Ze(N[Be[r]].dl,3);Ye(R,e-1),Ye(k,t-1)}(P.max_code+1,z.max_code+1,r+1),Je(R,k));je(),0!=e&&et()},$e=function(e,t){if(p[J++]=t,0==e?R[t].fc++:(e--,R[H[t]+fe+1].fc++,k[ke(e)].fc++,h[Z++]=e,ee|=te),te<<=1,7&J||($[Q++]=ee,ee=0,te=1),T>2&&!(4095&J)){var n,r=8*J,o=B-w;for(n=0;n<pe;n++)r+=k[n].fc*(5+be[n]);if(r>>=3,Z<parseInt(J/2)&&r<parseInt(o/2))return!0}return 8191==J||Z==ae},Je=function(e,t){var n,r,o,i,a=0,s=0,l=0,c=0;if(0!=J)do{7&a||(c=$[l++]),r=255&p[a++],1&c?(o=H[r],Re(o+fe+1,e),0!=(i=Ae[o])&&(r-=Y[o],Ze(r,i)),n=h[s++],o=ke(n),Re(o,t),0!=(i=be[o])&&(n-=q[o],Ze(n,i))):Re(r,e),c>>=1}while(a<J);Re(256,e)},Ze=function(e,t){v>16-t?(Te(m|=e<<v),m=e>>16-v,v+=t-16):(m|=e<<v,v+=t)},Qe=function(e,t){var n=0;do{n|=1&e,e>>=1,n<<=1}while(--t>0);return n>>1},et=function(){v>8?Te(m):v>0&&De(m),m=0,v=0},tt=function(){if(0!=c){var e,t;for(null!=i?(n=i,i=i.next):n=new xe,n.next=null,n.len=n.off=0,e=n,null==a?a=s=e:s=s.next=e,e.len=c-d,t=0;t<e.len;t++)e.ptr[t]=ve[d+t];c=d=0}var n};e.RawDeflate||(e.RawDeflate={}),e.RawDeflate.deflate=function(e,t){var r,o;oe=e,ie=0,void 0===t&&(t=6),function(e){var t;if(e?e<1?e=1:e>9&&(e=9):e=6,T=e,l=!1,C=!1,null==ve){for(i=a=s=null,ve=new Array(n),f=new Array(65536),h=new Array(ae),p=new Array(32832),g=new Array(65536),R=new Array(ge),t=0;t<ge;t++)R[t]=new we;for(k=new Array(61),t=0;t<61;t++)k[t]=new we;for(L=new Array(288),t=0;t<288;t++)L[t]=new we;for(I=new Array(pe),t=0;t<pe;t++)I[t]=new we;for(N=new Array(39),t=0;t<39;t++)N[t]=new we;P=new ye,z=new ye,F=new ye,V=new Array(16),X=new Array(573),G=new Array(573),H=new Array(256),K=new Array(512),Y=new Array(29),q=new Array(pe),$=new Array(parseInt(1024))}}(t);for(var c=new Array(1024),d=[];(r=Fe(c,0,c.length))>0;){var u=new Array(r);for(o=0;o<r;o++)u[o]=String.fromCharCode(c[o]);d[d.length]=u.join("")}return oe=null,d.join("")}}(this),function(e){if(!e.Base64){var t;"undefined"!=typeof module&&module.exports&&(t=require("buffer").Buffer);var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(n),o=String.fromCharCode,i=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?o(192|t>>>6)+o(128|63&t):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|63&t)},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,s=function(e){return e.replace(a,i)},l=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[n.charAt(r>>>18),n.charAt(r>>>12&63),t>=2?"=":n.charAt(r>>>6&63),t>=1?"=":n.charAt(63&r)].join("")},c=e.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,l)},d=t?function(e){return new t(e).toString("base64")}:function(e){return c(s(e))},u=function(e,t){return t?d(e).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):d(e)},f=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),h=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return o((t>>>10)+55296)+o(56320+(1023&t));case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},p=function(e){return e.replace(f,h)},g=function(e){var t=e.length,n=t%4,i=(t>0?r[e.charAt(0)]<<18:0)|(t>1?r[e.charAt(1)]<<12:0)|(t>2?r[e.charAt(2)]<<6:0)|(t>3?r[e.charAt(3)]:0),a=[o(i>>>16),o(i>>>8&255),o(255&i)];return a.length-=[0,0,2,1][n],a.join("")},m=e.atob||function(e){return e.replace(/[\s\S]{1,4}/g,g)},v=t?function(e){return new t(e,"base64").toString()}:function(e){return p(m(e))},w=function(e){return v(e.replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(e.Base64={VERSION:"2.1.1",atob:m,btoa:c,fromBase64:w,toBase64:u,utob:s,encode:u,encodeURI:function(e){return u(e,!0)},btou:p,decode:w},"function"==typeof Object.defineProperty){var y=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",y(function(){return w(this)})),Object.defineProperty(String.prototype,"toBase64",y(function(e){return u(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",y(function(){return u(this,!0)}))}}}}(this);var BinaryReader=function(e){this._buffer=e,this._pos=0};BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(e){this._checkSize(8*e);var t=this._buffer.substr(this._pos,e);return this._pos+=e,t},seek:function(e){this._pos=e,this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(e,t){var n=e+t+1,r=n>>3;this._checkSize(n);var o=Math.pow(2,t-1)-1,i=this._readBits(e+t,1,r),a=this._readBits(e,t,r),s=0,l=2,c=0;do{for(var d=this._readByte(++c,r),u=e%8||8,f=1<<u;f>>=1;)d&f&&(s+=1/l),l*=2}while(e-=u);return this._pos+=r,a==1+(o<<1)?s?NaN:i?-1/0:1/0:(1+-2*i)*(a||s?a?Math.pow(2,a-o)*(1+s):Math.pow(2,1-o)*s:0)},_decodeInt:function(e,t){var n=this._readBits(0,e,e/8),r=Math.pow(2,e),o=t&&n>=r/2?n-r:n;return this._pos+=e/8,o},_shl:function(e,t){for(++t;--t;e=1073741824&~(e%=2147483648)?2*(e-1073741824)+2147483647+1:2*e);return e},_readByte:function(e,t){return 255&this._buffer.charCodeAt(this._pos+t-e-1)},_readBits:function(e,t,n){var r=(e+t)%8,o=e%8,i=n-(e>>3)-1,a=n+(-(e+t)>>3),s=i-a,l=this._readByte(i,n)>>o&(1<<(s?8-o:t))-1;for(s&&r&&(l+=(this._readByte(a++,n)&(1<<r)-1)<<(s--<<3)-o);s;)l+=this._shl(this._readByte(a++,n),(s--<<3)-o);return l},_checkSize:function(e){this._pos,Math.ceil(e/8),this._buffer.length}};